<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>IB í•™ìŠµììƒ ì§„ë‹¨ ê´€ë¦¬ ëŒ€ì‹œë³´ë“œ</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Roboto', 'Oxygen', 'Ubuntu', sans-serif;
            background: linear-gradient(135deg, #f5f7fa 0%, #c3cfe2 100%);
            min-height: 100vh;
        }

        .header {
            background: white;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
            padding: 25px 0;
        }

        .header-content {
            max-width: 1400px;
            margin: 0 auto;
            padding: 0 20px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        h1 {
            color: #667eea;
            font-size: 2em;
        }

        .subtitle {
            color: #666;
            margin-top: 5px;
        }

        .btn {
            padding: 12px 24px;
            border: none;
            border-radius: 8px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            text-decoration: none;
            display: inline-block;
            transition: all 0.3s;
        }

        .btn-primary {
            background: #667eea;
            color: white;
        }

        .btn-primary:hover {
            background: #5568d3;
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(102, 126, 234, 0.3);
        }

        .btn-success {
            background: #10b981;
            color: white;
        }

        .btn-success:hover {
            background: #059669;
        }

        .btn-danger {
            background: #ef4444;
            color: white;
        }

        .btn-danger:hover {
            background: #dc2626;
        }

        .tabs {
            background: white;
            border-bottom: 2px solid #e5e7eb;
        }

        .tabs-container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 0 20px;
            display: flex;
            gap: 30px;
        }

        .tab {
            padding: 15px 20px;
            border: none;
            background: none;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            border-bottom: 3px solid transparent;
            transition: all 0.3s;
            color: #6b7280;
        }

        .tab.active {
            color: #667eea;
            border-bottom-color: #667eea;
        }

        .tab:hover {
            color: #667eea;
        }

        .content {
            max-width: 1400px;
            margin: 0 auto;
            padding: 30px 20px;
        }

        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .stat-card {
            background: white;
            border-radius: 15px;
            padding: 25px;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .stat-card.blue { border-left: 5px solid #667eea; }
        .stat-card.green { border-left: 5px solid #10b981; }
        .stat-card.purple { border-left: 5px solid #8b5cf6; }

        .stat-info h3 {
            color: #6b7280;
            font-size: 0.9em;
            margin-bottom: 10px;
        }

        .stat-value {
            font-size: 2.5em;
            font-weight: 700;
            color: #1f2937;
        }

        .stat-icon {
            font-size: 3em;
            padding: 15px;
            border-radius: 50%;
        }

        .stat-icon.blue { background: #e0e7ff; }
        .stat-icon.green { background: #d1fae5; }
        .stat-icon.purple { background: #ede9fe; }

        .card {
            background: white;
            border-radius: 15px;
            padding: 30px;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
            margin-bottom: 30px;
        }

        .card h2 {
            color: #1f2937;
            margin-bottom: 20px;
            font-size: 1.8em;
        }

        .profile-list {
            display: flex;
            flex-direction: column;
            gap: 15px;
        }

        .profile-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .profile-name {
            font-weight: 600;
            color: #374151;
        }

        .profile-bar-container {
            flex: 1;
            margin: 0 15px;
        }

        .profile-bar {
            width: 100%;
            height: 12px;
            background: #e5e7eb;
            border-radius: 10px;
            overflow: hidden;
        }

        .profile-bar-fill {
            height: 100%;
            transition: width 0.5s;
        }

        .profile-score {
            font-weight: 700;
            font-size: 1.2em;
        }

        table {
            width: 100%;
            border-collapse: collapse;
        }

        thead {
            background: #f9fafb;
        }

        th {
            padding: 15px;
            text-align: left;
            font-weight: 600;
            color: #6b7280;
            border-bottom: 2px solid #e5e7eb;
        }

        td {
            padding: 15px;
            border-bottom: 1px solid #e5e7eb;
        }

        tbody tr:hover {
            background: #f9fafb;
        }

        .tag {
            display: inline-block;
            padding: 5px 10px;
            border-radius: 20px;
            font-size: 0.85em;
            font-weight: 600;
            margin: 2px;
        }

        .empty-state {
            text-align: center;
            padding: 60px 20px;
            color: #6b7280;
        }

        .empty-state-icon {
            font-size: 4em;
            margin-bottom: 15px;
        }

        .hidden {
            display: none !important;
        }

        .chart-container {
            position: relative;
            height: 400px;
            margin: 20px auto;
            max-width: 600px;
        }

        .action-buttons {
            display: flex;
            gap: 10px;
            justify-content: flex-end;
            margin-bottom: 20px;
        }

        @media (max-width: 768px) {
            .header-content {
                flex-direction: column;
                gap: 15px;
                text-align: center;
            }

            .tabs-container {
                overflow-x: auto;
            }

            .stats-grid {
                grid-template-columns: 1fr;
            }

            table {
                font-size: 0.9em;
            }

            th, td {
                padding: 10px;
            }
        }
    </style>
</head>
<body>
    <!-- í—¤ë” -->
    <div class="header">
        <div class="header-content">
            <div>
                <h1>IB í•™ìŠµììƒ ì§„ë‹¨ ê´€ë¦¬ ì‹œìŠ¤í…œ</h1>
                <p class="subtitle">í•™ìƒë“¤ì˜ IB í•™ìŠµììƒ ì§„ë‹¨ ê²°ê³¼ë¥¼ ê´€ë¦¬í•˜ê³  ë¶„ì„í•©ë‹ˆë‹¤</p>
            </div>
            <a href="index.html" class="btn btn-primary">ğŸ¯ í…ŒìŠ¤íŠ¸ í˜ì´ì§€ë¡œ</a>
        </div>
    </div>

    <!-- íƒ­ -->
    <div class="tabs">
        <div class="tabs-container">
            <button class="tab active" data-tab="overview">ğŸ“Š ê°œìš”</button>
            <button class="tab" data-tab="students">ğŸ“‹ í•™ìƒ ëª©ë¡</button>
            <button class="tab" data-tab="statistics">ğŸ“ˆ í†µê³„ ë¶„ì„</button>
        </div>
    </div>

    <!-- ì½˜í…ì¸  -->
    <div class="content">
        <!-- ê°œìš” íƒ­ -->
        <div id="overview-tab">
            <div class="stats-grid">
                <div class="stat-card blue">
                    <div class="stat-info">
                        <h3>ì´ ì°¸ì—¬ í•™ìƒ</h3>
                        <div class="stat-value" id="total-students">0ëª…</div>
                    </div>
                    <div class="stat-icon blue">ğŸ‘¥</div>
                </div>

                <div class="stat-card green">
                    <div class="stat-info">
                        <h3>í‰ê·  ì™„ë£Œìœ¨</h3>
                        <div class="stat-value">100%</div>
                    </div>
                    <div class="stat-icon green">âœ…</div>
                </div>

                <div class="stat-card purple">
                    <div class="stat-info">
                        <h3>ìµœê·¼ í…ŒìŠ¤íŠ¸</h3>
                        <div class="stat-value" id="recent-test" style="font-size: 1.5em;">-</div>
                    </div>
                    <div class="stat-icon purple">ğŸ“…</div>
                </div>
            </div>

            <div class="card">
                <h2>ğŸ† ì¸ê¸° í•™ìŠµììƒ TOP 5</h2>
                <div id="top-profiles" class="profile-list"></div>
            </div>
        </div>

        <!-- í•™ìƒ ëª©ë¡ íƒ­ -->
        <div id="students-tab" class="hidden">
            <div class="card">
                <div class="action-buttons">
                    <button class="btn btn-success" id="export-csv">ğŸ“¥ CSV ë‚´ë³´ë‚´ê¸°</button>
                    <button class="btn btn-danger" id="clear-all">ğŸ—‘ï¸ ì „ì²´ ì‚­ì œ</button>
                </div>

                <h2>ğŸ“‹ í•™ìƒ ëª©ë¡</h2>
                <div id="student-table-container"></div>
            </div>
        </div>

        <!-- í†µê³„ íƒ­ -->
        <div id="statistics-tab" class="hidden">
            <div class="card">
                <h2>ğŸ“Š í•™ìŠµììƒ í‰ê·  ì ìˆ˜ ë¶„í¬</h2>
                <div class="chart-container">
                    <canvas id="radarChart"></canvas>
                </div>
            </div>

            <div class="card">
                <h2>ğŸ“ˆ í•™ìŠµììƒë³„ ìƒì„¸ í†µê³„</h2>
                <div id="detailed-stats"></div>
            </div>
        </div>
    </div>

    <script>
        // IB í•™ìŠµììƒ ì •ì˜
        const learnerProfiles = {
            inquirer: { name: 'íƒêµ¬í•˜ëŠ” ì‚¬ëŒ', nameEn: 'Inquirers', emoji: 'ğŸ”', color: '#3B82F6' },
            knowledgeable: { name: 'ì§€ì‹ì´ í’ë¶€í•œ ì‚¬ëŒ', nameEn: 'Knowledgeable', emoji: 'ğŸ“š', color: '#8B5CF6' },
            thinker: { name: 'ìƒê°í•˜ëŠ” ì‚¬ëŒ', nameEn: 'Thinkers', emoji: 'ğŸ’­', color: '#06B6D4' },
            communicator: { name: 'ì†Œí†µí•˜ëŠ” ì‚¬ëŒ', nameEn: 'Communicators', emoji: 'ğŸ’¬', color: '#10B981' },
            principled: { name: 'ì›ì¹™ì„ ì§€í‚¤ëŠ” ì‚¬ëŒ', nameEn: 'Principled', emoji: 'âš–ï¸', color: '#6366F1' },
            openMinded: { name: 'ì—´ë¦° ë§ˆìŒì„ ì§€ë‹Œ ì‚¬ëŒ', nameEn: 'Open-minded', emoji: 'ğŸŒ', color: '#14B8A6' },
            caring: { name: 'ë°°ë ¤í•˜ëŠ” ì‚¬ëŒ', nameEn: 'Caring', emoji: 'â¤ï¸', color: '#EF4444' },
            riskTaker: { name: 'ë„ì „í•˜ëŠ” ì‚¬ëŒ', nameEn: 'Risk-takers', emoji: 'ğŸš€', color: '#F59E0B' },
            balanced: { name: 'ê· í˜• ì¡íŒ ì‚¬ëŒ', nameEn: 'Balanced', emoji: 'âš–ï¸', color: '#84CC16' },
            reflective: { name: 'ì„±ì°°í•˜ëŠ” ì‚¬ëŒ', nameEn: 'Reflective', emoji: 'ğŸ¤”', color: '#A855F7' }
        };

        let results = [];
        let radarChartInstance = null;

        // ë°ì´í„° ë¡œë“œ
        function loadResults() {
            try {
                results = JSON.parse(localStorage.getItem('ibTestResults') || '[]');
            } catch (e) {
                console.error('Failed to load results', e);
                results = [];
            }
        }

        // íƒ­ ì „í™˜
        document.querySelectorAll('.tab').forEach(tab => {
            tab.addEventListener('click', () => {
                document.querySelectorAll('.tab').forEach(t => t.classList.remove('active'));
                tab.classList.add('active');

                const tabName = tab.dataset.tab;
                document.getElementById('overview-tab').classList.add('hidden');
                document.getElementById('students-tab').classList.add('hidden');
                document.getElementById('statistics-tab').classList.add('hidden');
                document.getElementById(`${tabName}-tab`).classList.remove('hidden');

                if (tabName === 'statistics') {
                    renderStatistics();
                }
            });
        });

        // ê°œìš” ë Œë”ë§
        function renderOverview() {
            document.getElementById('total-students').textContent = `${results.length}ëª…`;
            
            if (results.length > 0) {
                const lastTest = new Date(results[results.length - 1].date);
                document.getElementById('recent-test').textContent = lastTest.toLocaleDateString('ko-KR');
            }

            // TOP 5 í•™ìŠµììƒ
            const topProfiles = getTopProfiles();
            const topProfilesHtml = topProfiles.length > 0 ? topProfiles.map(([profile, count], index) => {
                const profileData = learnerProfiles[profile];
                const maxCount = topProfiles[0][1];
                const percentage = (count / maxCount) * 100;
                return `
                    <div class="profile-item">
                        <span class="profile-name">${index + 1}. ${profileData.emoji} ${profileData.name}</span>
                        <div class="profile-bar-container">
                            <div class="profile-bar">
                                <div class="profile-bar-fill" style="width: ${percentage}%; background-color: ${profileData.color};"></div>
                            </div>
                        </div>
                        <span class="profile-score" style="color: ${profileData.color};">${count}ì </span>
                    </div>
                `;
            }).join('') : '<div class="empty-state"><div class="empty-state-icon">ğŸ“­</div><p>ì•„ì§ ë°ì´í„°ê°€ ì—†ìŠµë‹ˆë‹¤.</p></div>';

            document.getElementById('top-profiles').innerHTML = topProfilesHtml;
        }

        function getTopProfiles() {
            if (results.length === 0) return [];

            const profileCounts = {};
            Object.keys(learnerProfiles).forEach(profile => {
                profileCounts[profile] = 0;
            });

            results.forEach(result => {
                result.topProfiles.forEach((profile, index) => {
                    if (index === 0) profileCounts[profile[0]] += 3;
                    else if (index === 1) profileCounts[profile[0]] += 2;
                    else if (index === 2) profileCounts[profile[0]] += 1;
                });
            });

            return Object.entries(profileCounts)
                .sort((a, b) => b[1] - a[1])
                .slice(0, 5);
        }

        // í•™ìƒ ëª©ë¡ ë Œë”ë§
        function renderStudentList() {
            if (results.length === 0) {
                document.getElementById('student-table-container').innerHTML = `
                    <div class="empty-state">
                        <div class="empty-state-icon">ğŸ“­</div>
                        <p>ì•„ì§ í…ŒìŠ¤íŠ¸ ê²°ê³¼ê°€ ì—†ìŠµë‹ˆë‹¤.</p>
                    </div>
                `;
                return;
            }

            const tableHtml = `
                <table>
                    <thead>
                        <tr>
                            <th>ì´ë¦„</th>
                            <th>í•™ë…„</th>
                            <th>í…ŒìŠ¤íŠ¸ ë‚ ì§œ</th>
                            <th>ìƒìœ„ í•™ìŠµììƒ</th>
                            <th>ì‘ì—…</th>
                        </tr>
                    </thead>
                    <tbody>
                        ${results.map((result, index) => `
                            <tr>
                                <td><strong>${result.name}</strong></td>
                                <td>${result.grade}</td>
                                <td>${new Date(result.date).toLocaleString('ko-KR')}</td>
                                <td>
                                    ${result.topProfiles.slice(0, 3).map(([profile, score]) => {
                                        const profileData = learnerProfiles[profile];
                                        return `<span class="tag" style="background-color: ${profileData.color}20; color: ${profileData.color};">
                                            ${profileData.emoji} ${profileData.name.slice(0, 4)} (${score}%)
                                        </span>`;
                                    }).join('')}
                                </td>
                                <td>
                                    <button class="btn btn-danger" style="padding: 5px 10px; font-size: 0.9em;" onclick="deleteResult(${index})">ì‚­ì œ</button>
                                </td>
                            </tr>
                        `).join('')}
                    </tbody>
                </table>
            `;
            document.getElementById('student-table-container').innerHTML = tableHtml;
        }

        // í†µê³„ ë Œë”ë§
        function renderStatistics() {
            if (results.length === 0) {
                document.getElementById('detailed-stats').innerHTML = `
                    <div class="empty-state">
                        <div class="empty-state-icon">ğŸ“Š</div>
                        <p>í†µê³„ë¥¼ í‘œì‹œí•˜ë ¤ë©´ ìµœì†Œ 1ëª… ì´ìƒì˜ ë°ì´í„°ê°€ í•„ìš”í•©ë‹ˆë‹¤.</p>
                    </div>
                `;
                return;
            }

            // í‰ê·  ì ìˆ˜ ê³„ì‚°
            const profileAverages = {};
            Object.keys(learnerProfiles).forEach(profile => {
                const total = results.reduce((sum, r) => sum + (r.scores[profile] || 0), 0);
                profileAverages[profile] = Math.round(total / results.length);
            });

            // ë ˆì´ë” ì°¨íŠ¸
            if (radarChartInstance) {
                radarChartInstance.destroy();
            }

            const ctx = document.getElementById('radarChart').getContext('2d');
            radarChartInstance = new Chart(ctx, {
                type: 'radar',
                data: {
                    labels: Object.values(learnerProfiles).map(p => p.name),
                    datasets: [{
                        label: 'í‰ê·  ì ìˆ˜',
                        data: Object.keys(learnerProfiles).map(key => profileAverages[key]),
                        backgroundColor: 'rgba(102, 126, 234, 0.2)',
                        borderColor: 'rgba(102, 126, 234, 1)',
                        borderWidth: 2,
                        pointBackgroundColor: 'rgba(102, 126, 234, 1)',
                        pointBorderColor: '#fff',
                        pointHoverBackgroundColor: '#fff',
                        pointHoverBorderColor: 'rgba(102, 126, 234, 1)'
                    }]
                },
                options: {
                    scales: {
                        r: {
                            beginAtZero: true,
                            max: 100,
                            ticks: {
                                stepSize: 20
                            }
                        }
                    },
                    plugins: {
                        legend: {
                            display: false
                        }
                    }
                }
            });

            // ìƒì„¸ í†µê³„
            const detailedStatsHtml = Object.entries(profileAverages)
                .sort((a, b) => b[1] - a[1])
                .map(([profile, avg]) => {
                    const profileData = learnerProfiles[profile];
                    return `
                        <div class="profile-item" style="margin-bottom: 20px;">
                            <span class="profile-name">${profileData.emoji} ${profileData.name}</span>
                            <div class="profile-bar-container">
                                <div class="profile-bar">
                                    <div class="profile-bar-fill" style="width: ${avg}%; background-color: ${profileData.color};"></div>
                                </div>
                            </div>
                            <span class="profile-score" style="color: ${profileData.color};">${avg}%</span>
                        </div>
                    `;
                }).join('');
            
            document.getElementById('detailed-stats').innerHTML = detailedStatsHtml;
        }

        // ê²°ê³¼ ì‚­ì œ
        function deleteResult(index) {
            if (confirm('ì •ë§ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?')) {
                results.splice(index, 1);
                localStorage.setItem('ibTestResults', JSON.stringify(results));
                renderStudentList();
                renderOverview();
            }
        }

        // ì „ì²´ ì‚­ì œ
        document.getElementById('clear-all').addEventListener('click', () => {
            if (confirm('ëª¨ë“  ë°ì´í„°ë¥¼ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ? ì´ ì‘ì—…ì€ ë˜ëŒë¦´ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.')) {
                localStorage.removeItem('ibTestResults');
                results = [];
                renderStudentList();
                renderOverview();
            }
        });

        // CSV ë‚´ë³´ë‚´ê¸°
        document.getElementById('export-csv').addEventListener('click', () => {
            if (results.length === 0) {
                alert('ë‚´ë³´ë‚¼ ë°ì´í„°ê°€ ì—†ìŠµë‹ˆë‹¤.');
                return;
            }

            const headers = ['ì´ë¦„', 'í•™ë…„', 'í…ŒìŠ¤íŠ¸ ë‚ ì§œ', ...Object.values(learnerProfiles).map(p => p.name)];
            const rows = results.map(r => [
                r.name,
                r.grade,
                new Date(r.date).toLocaleString('ko-KR'),
                ...Object.keys(learnerProfiles).map(key => r.scores[key])
            ]);

            let csv = headers.join(',') + '\n';
            rows.forEach(row => {
                csv += row.join(',') + '\n';
            });

            const blob = new Blob(['\uFEFF' + csv], { type: 'text/csv;charset=utf-8;' });
            const link = document.createElement('a');
            link.href = URL.createObjectURL(blob);
            link.download = `IBí•™ìŠµììƒ_ì§„ë‹¨ê²°ê³¼_${new Date().toLocaleDateString('ko-KR')}.csv`;
            link.click();
        });

        // ì´ˆê¸°í™”
        loadResults();
        renderOverview();
        renderStudentList();
    </script>
</body>
</html>