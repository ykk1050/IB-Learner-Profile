<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>IB í•™ìŠµììƒ ì§„ë‹¨ ê´€ë¦¬ ëŒ€ì‹œë³´ë“œ</title>
    <script crossorigin src="https://unpkg.com/react@18.2.0/umd/react.development.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18.2.0/umd/react-dom.development.js"></script>
    <script src="https://unpkg.com/@babel/standalone@7.23.5/babel.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
</head>
<body>
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect, useRef } = React;

        // IB í•™ìŠµììƒ 10ê°€ì§€ ì •ì˜
        const learnerProfiles = {
            inquirer: { name: 'íƒêµ¬í•˜ëŠ” ì‚¬ëŒ', nameEn: 'Inquirers', emoji: 'ğŸ”', color: '#3B82F6' },
            knowledgeable: { name: 'ì§€ì‹ì´ í’ë¶€í•œ ì‚¬ëŒ', nameEn: 'Knowledgeable', emoji: 'ğŸ“š', color: '#8B5CF6' },
            thinker: { name: 'ìƒê°í•˜ëŠ” ì‚¬ëŒ', nameEn: 'Thinkers', emoji: 'ğŸ’­', color: '#06B6D4' },
            communicator: { name: 'ì†Œí†µí•˜ëŠ” ì‚¬ëŒ', nameEn: 'Communicators', emoji: 'ğŸ’¬', color: '#10B981' },
            principled: { name: 'ì›ì¹™ì„ ì§€í‚¤ëŠ” ì‚¬ëŒ', nameEn: 'Principled', emoji: 'âš–ï¸', color: '#6366F1' },
            openMinded: { name: 'ì—´ë¦° ë§ˆìŒì„ ì§€ë‹Œ ì‚¬ëŒ', nameEn: 'Open-minded', emoji: 'ğŸŒ', color: '#14B8A6' },
            caring: { name: 'ë°°ë ¤í•˜ëŠ” ì‚¬ëŒ', nameEn: 'Caring', emoji: 'â¤ï¸', color: '#EF4444' },
            riskTaker: { name: 'ë„ì „í•˜ëŠ” ì‚¬ëŒ', nameEn: 'Risk-takers', emoji: 'ğŸš€', color: '#F59E0B' },
            balanced: { name: 'ê· í˜• ì¡íŒ ì‚¬ëŒ', nameEn: 'Balanced', emoji: 'âš–ï¸', color: '#84CC16' },
            reflective: { name: 'ì„±ì°°í•˜ëŠ” ì‚¬ëŒ', nameEn: 'Reflective', emoji: 'ğŸ¤”', color: '#A855F7' }
        };

        function Dashboard() {
            const [results, setResults] = useState([]);
            const [selectedView, setSelectedView] = useState('overview'); // overview, studentList, statistics
            const chartRef = useRef(null);
            const chartInstance = useRef(null);

            useEffect(() => {
                loadResults();
            }, []);

            useEffect(() => {
                if (selectedView === 'statistics' && results.length > 0) {
                    renderChart();
                }
                return () => {
                    if (chartInstance.current) {
                        chartInstance.current.destroy();
                    }
                };
            }, [selectedView, results]);

            const loadResults = () => {
                try {
                    const data = JSON.parse(localStorage.getItem('ibTestResults') || '[]');
                    setResults(data);
                } catch (e) {
                    console.error('Failed to load results', e);
                }
            };

            const deleteResult = (index) => {
                if (confirm('ì •ë§ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?')) {
                    const newResults = results.filter((_, i) => i !== index);
                    setResults(newResults);
                    localStorage.setItem('ibTestResults', JSON.stringify(newResults));
                }
            };

            const clearAllData = () => {
                if (confirm('ëª¨ë“  ë°ì´í„°ë¥¼ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ? ì´ ì‘ì—…ì€ ë˜ëŒë¦´ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.')) {
                    localStorage.removeItem('ibTestResults');
                    setResults([]);
                }
            };

            const exportToCSV = () => {
                if (results.length === 0) {
                    alert('ë‚´ë³´ë‚¼ ë°ì´í„°ê°€ ì—†ìŠµë‹ˆë‹¤.');
                    return;
                }

                const headers = ['ì´ë¦„', 'í•™ë…„', 'í…ŒìŠ¤íŠ¸ ë‚ ì§œ', ...Object.values(learnerProfiles).map(p => p.name)];
                const rows = results.map(r => [
                    r.name,
                    r.grade,
                    new Date(r.date).toLocaleString('ko-KR'),
                    ...Object.keys(learnerProfiles).map(key => r.scores[key])
                ]);

                let csv = headers.join(',') + '\n';
                rows.forEach(row => {
                    csv += row.join(',') + '\n';
                });

                const blob = new Blob(['\uFEFF' + csv], { type: 'text/csv;charset=utf-8;' });
                const link = document.createElement('a');
                link.href = URL.createObjectURL(blob);
                link.download = `IBí•™ìŠµììƒ_ì§„ë‹¨ê²°ê³¼_${new Date().toLocaleDateString('ko-KR')}.csv`;
                link.click();
            };

            const renderChart = () => {
                if (!chartRef.current || results.length === 0) return;

                // ê° í•™ìŠµììƒë³„ í‰ê·  ì ìˆ˜ ê³„ì‚°
                const profileAverages = {};
                Object.keys(learnerProfiles).forEach(profile => {
                    const total = results.reduce((sum, r) => sum + (r.scores[profile] || 0), 0);
                    profileAverages[profile] = Math.round(total / results.length);
                });

                if (chartInstance.current) {
                    chartInstance.current.destroy();
                }

                const ctx = chartRef.current.getContext('2d');
                chartInstance.current = new Chart(ctx, {
                    type: 'radar',
                    data: {
                        labels: Object.values(learnerProfiles).map(p => p.name),
                        datasets: [{
                            label: 'í‰ê·  ì ìˆ˜',
                            data: Object.keys(learnerProfiles).map(key => profileAverages[key]),
                            backgroundColor: 'rgba(99, 102, 241, 0.2)',
                            borderColor: 'rgba(99, 102, 241, 1)',
                            borderWidth: 2,
                            pointBackgroundColor: 'rgba(99, 102, 241, 1)',
                            pointBorderColor: '#fff',
                            pointHoverBackgroundColor: '#fff',
                            pointHoverBorderColor: 'rgba(99, 102, 241, 1)'
                        }]
                    },
                    options: {
                        scales: {
                            r: {
                                beginAtZero: true,
                                max: 100,
                                ticks: {
                                    stepSize: 20
                                }
                            }
                        },
                        plugins: {
                            legend: {
                                display: false
                            }
                        }
                    }
                });
            };

            const getTopProfiles = () => {
                if (results.length === 0) return [];

                const profileCounts = {};
                Object.keys(learnerProfiles).forEach(profile => {
                    profileCounts[profile] = 0;
                });

                results.forEach(result => {
                    result.topProfiles.forEach((profile, index) => {
                        if (index === 0) profileCounts[profile[0]] += 3; // 1ë“±
                        else if (index === 1) profileCounts[profile[0]] += 2; // 2ë“±
                        else if (index === 2) profileCounts[profile[0]] += 1; // 3ë“±
                    });
                });

                return Object.entries(profileCounts)
                    .sort((a, b) => b[1] - a[1])
                    .slice(0, 5);
            };

            // Overview í™”ë©´
            const renderOverview = () => {
                const topProfiles = getTopProfiles();

                return (
                    <div className="space-y-6">
                        {/* í†µê³„ ì¹´ë“œ */}
                        <div className="grid grid-cols-1 md:grid-cols-3 gap-6">
                            <div className="bg-white rounded-xl shadow-lg p-6 border-l-4 border-indigo-600">
                                <div className="flex items-center justify-between">
                                    <div>
                                        <p className="text-gray-500 text-sm font-medium">ì´ ì°¸ì—¬ í•™ìƒ</p>
                                        <p className="text-3xl font-bold text-gray-800 mt-2">{results.length}ëª…</p>
                                    </div>
                                    <div className="bg-indigo-100 p-4 rounded-full">
                                        <span className="text-3xl">ğŸ‘¥</span>
                                    </div>
                                </div>
                            </div>

                            <div className="bg-white rounded-xl shadow-lg p-6 border-l-4 border-green-600">
                                <div className="flex items-center justify-between">
                                    <div>
                                        <p className="text-gray-500 text-sm font-medium">í‰ê·  ì™„ë£Œìœ¨</p>
                                        <p className="text-3xl font-bold text-gray-800 mt-2">100%</p>
                                    </div>
                                    <div className="bg-green-100 p-4 rounded-full">
                                        <span className="text-3xl">âœ…</span>
                                    </div>
                                </div>
                            </div>

                            <div className="bg-white rounded-xl shadow-lg p-6 border-l-4 border-purple-600">
                                <div className="flex items-center justify-between">
                                    <div>
                                        <p className="text-gray-500 text-sm font-medium">ìµœê·¼ í…ŒìŠ¤íŠ¸</p>
                                        <p className="text-lg font-bold text-gray-800 mt-2">
                                            {results.length > 0 
                                                ? new Date(results[results.length - 1].date).toLocaleDateString('ko-KR')
                                                : '-'
                                            }
                                        </p>
                                    </div>
                                    <div className="bg-purple-100 p-4 rounded-full">
                                        <span className="text-3xl">ğŸ“…</span>
                                    </div>
                                </div>
                            </div>
                        </div>

                        {/* ê°€ì¥ ë§ì´ ë‚˜ì˜¨ í•™ìŠµììƒ */}
                        <div className="bg-white rounded-xl shadow-lg p-8">
                            <h3 className="text-2xl font-bold text-gray-800 mb-6">ğŸ† ì¸ê¸° í•™ìŠµììƒ TOP 5</h3>
                            {topProfiles.length > 0 ? (
                                <div className="space-y-4">
                                    {topProfiles.map(([profile, count], index) => {
                                        const profileData = learnerProfiles[profile];
                                        const maxCount = topProfiles[0][1];
                                        const percentage = (count / maxCount) * 100;
                                        return (
                                            <div key={profile}>
                                                <div className="flex justify-between items-center mb-2">
                                                    <span className="font-medium text-gray-700">
                                                        {index + 1}. {profileData.emoji} {profileData.name}
                                                    </span>
                                                    <span className="font-bold text-indigo-600">{count}ì </span>
                                                </div>
                                                <div className="w-full bg-gray-200 rounded-full h-3">
                                                    <div
                                                        className="h-3 rounded-full transition-all duration-500"
                                                        style={{ 
                                                            width: `${percentage}%`,
                                                            backgroundColor: profileData.color
                                                        }}
                                                    ></div>
                                                </div>
                                            </div>
                                        );
                                    })}
                                </div>
                            ) : (
                                <p className="text-gray-500 text-center py-8">ì•„ì§ ë°ì´í„°ê°€ ì—†ìŠµë‹ˆë‹¤.</p>
                            )}
                        </div>
                    </div>
                );
            };

            // í•™ìƒ ëª©ë¡ í™”ë©´
            const renderStudentList = () => {
                return (
                    <div className="bg-white rounded-xl shadow-lg overflow-hidden">
                        <div className="p-6 border-b border-gray-200">
                            <div className="flex justify-between items-center">
                                <h3 className="text-2xl font-bold text-gray-800">ğŸ“‹ í•™ìƒ ëª©ë¡</h3>
                                <div className="space-x-2">
                                    <button
                                        onClick={exportToCSV}
                                        className="bg-green-600 text-white px-4 py-2 rounded-lg hover:bg-green-700 transition"
                                    >
                                        ğŸ“¥ CSV ë‚´ë³´ë‚´ê¸°
                                    </button>
                                    <button
                                        onClick={clearAllData}
                                        className="bg-red-600 text-white px-4 py-2 rounded-lg hover:bg-red-700 transition"
                                    >
                                        ğŸ—‘ï¸ ì „ì²´ ì‚­ì œ
                                    </button>
                                </div>
                            </div>
                        </div>

                        {results.length > 0 ? (
                            <div className="overflow-x-auto">
                                <table className="w-full">
                                    <thead className="bg-gray-50">
                                        <tr>
                                            <th className="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">ì´ë¦„</th>
                                            <th className="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">í•™ë…„</th>
                                            <th className="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">í…ŒìŠ¤íŠ¸ ë‚ ì§œ</th>
                                            <th className="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">ìƒìœ„ í•™ìŠµììƒ</th>
                                            <th className="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">ì‘ì—…</th>
                                        </tr>
                                    </thead>
                                    <tbody className="bg-white divide-y divide-gray-200">
                                        {results.map((result, index) => (
                                            <tr key={index} className="hover:bg-gray-50">
                                                <td className="px-6 py-4 whitespace-nowrap">
                                                    <div className="text-sm font-medium text-gray-900">{result.name}</div>
                                                </td>
                                                <td className="px-6 py-4 whitespace-nowrap">
                                                    <div className="text-sm text-gray-900">{result.grade}</div>
                                                </td>
                                                <td className="px-6 py-4 whitespace-nowrap">
                                                    <div className="text-sm text-gray-500">
                                                        {new Date(result.date).toLocaleString('ko-KR')}
                                                    </div>
                                                </td>
                                                <td className="px-6 py-4">
                                                    <div className="flex flex-wrap gap-1">
                                                        {result.topProfiles.slice(0, 3).map(([profile, score]) => {
                                                            const profileData = learnerProfiles[profile];
                                                            return (
                                                                <span
                                                                    key={profile}
                                                                    className="inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium"
                                                                    style={{
                                                                        backgroundColor: profileData.color + '20',
                                                                        color: profileData.color
                                                                    }}
                                                                >
                                                                    {profileData.emoji} {profileData.name.slice(0, 4)} ({score}%)
                                                                </span>
                                                            );
                                                        })}
                                                    </div>
                                                </td>
                                                <td className="px-6 py-4 whitespace-nowrap text-sm font-medium">
                                                    <button
                                                        onClick={() => deleteResult(index)}
                                                        className="text-red-600 hover:text-red-900"
                                                    >
                                                        ì‚­ì œ
                                                    </button>
                                                </td>
                                            </tr>
                                        ))}
                                    </tbody>
                                </table>
                            </div>
                        ) : (
                            <div className="p-12 text-center text-gray-500">
                                <p className="text-xl mb-2">ğŸ“­</p>
                                <p>ì•„ì§ í…ŒìŠ¤íŠ¸ ê²°ê³¼ê°€ ì—†ìŠµë‹ˆë‹¤.</p>
                            </div>
                        )}
                    </div>
                );
            };

            // í†µê³„ í™”ë©´
            const renderStatistics = () => {
                if (results.length === 0) {
                    return (
                        <div className="bg-white rounded-xl shadow-lg p-12 text-center text-gray-500">
                            <p className="text-xl mb-2">ğŸ“Š</p>
                            <p>í†µê³„ë¥¼ í‘œì‹œí•˜ë ¤ë©´ ìµœì†Œ 1ëª… ì´ìƒì˜ ë°ì´í„°ê°€ í•„ìš”í•©ë‹ˆë‹¤.</p>
                        </div>
                    );
                }

                const profileAverages = {};
                Object.keys(learnerProfiles).forEach(profile => {
                    const total = results.reduce((sum, r) => sum + (r.scores[profile] || 0), 0);
                    profileAverages[profile] = Math.round(total / results.length);
                });

                return (
                    <div className="space-y-6">
                        {/* ë ˆì´ë” ì°¨íŠ¸ */}
                        <div className="bg-white rounded-xl shadow-lg p-8">
                            <h3 className="text-2xl font-bold text-gray-800 mb-6">ğŸ“Š í•™ìŠµììƒ í‰ê·  ì ìˆ˜ ë¶„í¬</h3>
                            <div className="flex justify-center">
                                <canvas ref={chartRef} width="400" height="400"></canvas>
                            </div>
                        </div>

                        {/* í•™ìŠµììƒë³„ ìƒì„¸ í†µê³„ */}
                        <div className="bg-white rounded-xl shadow-lg p-8">
                            <h3 className="text-2xl font-bold text-gray-800 mb-6">ğŸ“ˆ í•™ìŠµììƒë³„ ìƒì„¸ í†µê³„</h3>
                            <div className="grid grid-cols-1 md:grid-cols-2 gap-4">
                                {Object.entries(profileAverages)
                                    .sort((a, b) => b[1] - a[1])
                                    .map(([profile, avg]) => {
                                        const profileData = learnerProfiles[profile];
                                        return (
                                            <div key={profile} className="border rounded-lg p-4">
                                                <div className="flex items-center justify-between mb-2">
                                                    <span className="font-medium text-gray-700">
                                                        {profileData.emoji} {profileData.name}
                                                    </span>
                                                    <span className="text-2xl font-bold" style={{ color: profileData.color }}>
                                                        {avg}%
                                                    </span>
                                                </div>
                                                <div className="w-full bg-gray-200 rounded-full h-2">
                                                    <div
                                                        className="h-2 rounded-full transition-all"
                                                        style={{ 
                                                            width: `${avg}%`,
                                                            backgroundColor: profileData.color
                                                        }}
                                                    ></div>
                                                </div>
                                            </div>
                                        );
                                    })}
                            </div>
                        </div>
                    </div>
                );
            };

            return (
                <div className="min-h-screen bg-gradient-to-br from-gray-50 to-blue-50">
                    {/* í—¤ë” */}
                    <div className="bg-white shadow-md">
                        <div className="max-w-7xl mx-auto px-4 py-6">
                            <div className="flex justify-between items-center">
                                <div>
                                    <h1 className="text-3xl font-bold text-indigo-600">IB í•™ìŠµììƒ ì§„ë‹¨ ê´€ë¦¬ ì‹œìŠ¤í…œ</h1>
                                    <p className="text-gray-500 mt-1">í•™ìƒë“¤ì˜ IB í•™ìŠµììƒ ì§„ë‹¨ ê²°ê³¼ë¥¼ ê´€ë¦¬í•˜ê³  ë¶„ì„í•©ë‹ˆë‹¤</p>
                                </div>
                                <a
                                    href="ib-learner-profile-test.html"
                                    className="bg-indigo-600 text-white px-6 py-3 rounded-lg hover:bg-indigo-700 transition font-semibold"
                                >
                                    ğŸ¯ í…ŒìŠ¤íŠ¸ í˜ì´ì§€ë¡œ
                                </a>
                            </div>
                        </div>
                    </div>

                    {/* ë„¤ë¹„ê²Œì´ì…˜ íƒ­ */}
                    <div className="bg-white border-b">
                        <div className="max-w-7xl mx-auto px-4">
                            <div className="flex space-x-8">
                                <button
                                    onClick={() => setSelectedView('overview')}
                                    className={`py-4 px-2 border-b-2 font-medium transition ${
                                        selectedView === 'overview'
                                            ? 'border-indigo-600 text-indigo-600'
                                            : 'border-transparent text-gray-500 hover:text-gray-700'
                                    }`}
                                >
                                    ğŸ“Š ê°œìš”
                                </button>
                                <button
                                    onClick={() => setSelectedView('studentList')}
                                    className={`py-4 px-2 border-b-2 font-medium transition ${
                                        selectedView === 'studentList'
                                            ? 'border-indigo-600 text-indigo-600'
                                            : 'border-transparent text-gray-500 hover:text-gray-700'
                                    }`}
                                >
                                    ğŸ“‹ í•™ìƒ ëª©ë¡
                                </button>
                                <button
                                    onClick={() => setSelectedView('statistics')}
                                    className={`py-4 px-2 border-b-2 font-medium transition ${
                                        selectedView === 'statistics'
                                            ? 'border-indigo-600 text-indigo-600'
                                            : 'border-transparent text-gray-500 hover:text-gray-700'
                                    }`}
                                >
                                    ğŸ“ˆ í†µê³„ ë¶„ì„
                                </button>
                            </div>
                        </div>
                    </div>

                    {/* ì½˜í…ì¸  ì˜ì—­ */}
                    <div className="max-w-7xl mx-auto px-4 py-8">
                        {selectedView === 'overview' && renderOverview()}
                        {selectedView === 'studentList' && renderStudentList()}
                        {selectedView === 'statistics' && renderStatistics()}
                    </div>
                </div>
            );
        }

        ReactDOM.render(<Dashboard />, document.getElementById('root'));
    </script>
</body>
</html>