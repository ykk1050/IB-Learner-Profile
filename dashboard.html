<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>IB í•™ìŠµììƒ ì§„ë‹¨ ê´€ë¦¬ ëŒ€ì‹œë³´ë“œ</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Roboto', 'Oxygen', 'Ubuntu', sans-serif;
            background: linear-gradient(135deg, #f5f7fa 0%, #c3cfe2 100%);
            min-height: 100vh;
        }

        .header {
            background: white;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
            padding: 25px 0;
        }

        .header-content {
            max-width: 1400px;
            margin: 0 auto;
            padding: 0 20px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        h1 {
            color: #667eea;
            font-size: 2em;
        }

        .subtitle {
            color: #666;
            margin-top: 5px;
        }

        .btn {
            padding: 12px 24px;
            border: none;
            border-radius: 8px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            text-decoration: none;
            display: inline-block;
            transition: all 0.3s;
        }

        .btn-primary {
            background: #667eea;
            color: white;
        }

        .btn-primary:hover {
            background: #5568d3;
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(102, 126, 234, 0.3);
        }

        .btn-success {
            background: #10b981;
            color: white;
        }

        .btn-success:hover {
            background: #059669;
        }

        .btn-danger {
            background: #ef4444;
            color: white;
        }

        .btn-danger:hover {
            background: #dc2626;
        }

        .tabs {
            background: white;
            border-bottom: 2px solid #e5e7eb;
        }

        /* í•„í„° ìŠ¤íƒ€ì¼ ì¶”ê°€ */
        .filter-bar {
            background: #fff;
            border-bottom: 1px solid #e5e7eb;
            padding: 15px 0;
            margin-bottom: 20px;
        }

        .filter-container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 0 20px;
            display: flex;
            gap: 30px;
            align-items: center;
        }

        .filter-group {
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .filter-group label {
            font-weight: 600;
            color: #4b5563;
            font-size: 0.95em;
        }

        .filter-group select {
            padding: 8px 30px 8px 12px;
            border: 1px solid #d1d5db;
            border-radius: 6px;
            font-size: 14px;
            color: #374151;
            min-width: 140px;
            background-color: white;
            cursor: pointer;
            outline: none;
        }

        .filter-group select:focus {
            border-color: #667eea;
            box-shadow: 0 0 0 2px rgba(102, 126, 234, 0.1);
        }

        .tabs-container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 0 20px;
            display: flex;
            gap: 30px;
        }

        .tab {
            padding: 15px 20px;
            border: none;
            background: none;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            border-bottom: 3px solid transparent;
            transition: all 0.3s;
            color: #6b7280;
        }

        .tab.active {
            color: #667eea;
            border-bottom-color: #667eea;
        }

        .tab:hover {
            color: #667eea;
        }

        .content {
            max-width: 1400px;
            margin: 0 auto;
            padding: 30px 20px;
        }

        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .stat-card {
            background: white;
            border-radius: 15px;
            padding: 25px;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .stat-card.blue { border-left: 5px solid #667eea; }
        .stat-card.green { border-left: 5px solid #10b981; }
        .stat-card.purple { border-left: 5px solid #8b5cf6; }

        .stat-info h3 {
            color: #6b7280;
            font-size: 0.9em;
            margin-bottom: 10px;
        }

        .stat-value {
            font-size: 2.5em;
            font-weight: 700;
            color: #1f2937;
        }

        .stat-icon {
            font-size: 3em;
            padding: 15px;
            border-radius: 50%;
        }

        .stat-icon.blue { background: #e0e7ff; }
        .stat-icon.green { background: #d1fae5; }
        .stat-icon.purple { background: #ede9fe; }

        .card {
            background: white;
            border-radius: 15px;
            padding: 30px;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
            margin-bottom: 30px;
        }

        .card h2 {
            color: #1f2937;
            margin-bottom: 20px;
            font-size: 1.8em;
        }

        .profile-list {
            display: flex;
            flex-direction: column;
            gap: 15px;
        }

        .profile-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .profile-name {
            font-weight: 600;
            color: #374151;
        }

        .profile-bar-container {
            flex: 1;
            margin: 0 15px;
        }

        .profile-bar {
            width: 100%;
            height: 12px;
            background: #e5e7eb;
            border-radius: 10px;
            overflow: hidden;
        }

        .profile-bar-fill {
            height: 100%;
            transition: width 0.5s;
        }

        .profile-score {
            font-weight: 700;
            font-size: 1.2em;
        }

        table {
            width: 100%;
            border-collapse: collapse;
        }

        thead {
            background: #f9fafb;
        }

        th {
            padding: 15px;
            text-align: left;
            font-weight: 600;
            color: #6b7280;
            border-bottom: 2px solid #e5e7eb;
        }

        td {
            padding: 15px;
            border-bottom: 1px solid #e5e7eb;
        }

        tbody tr:hover {
            background: #f9fafb;
        }

        .tag {
            display: inline-block;
            padding: 5px 10px;
            border-radius: 20px;
            font-size: 0.85em;
            font-weight: 600;
            margin: 2px;
        }

        .empty-state {
            text-align: center;
            padding: 60px 20px;
            color: #6b7280;
        }

        .empty-state-icon {
            font-size: 4em;
            margin-bottom: 15px;
        }

        .hidden {
            display: none !important;
        }

        .chart-container {
            position: relative;
            height: 400px;
            margin: 20px auto;
            max-width: 600px;
        }

        .action-buttons {
            display: flex;
            gap: 10px;
            justify-content: flex-end;
            margin-bottom: 20px;
        }

        /* í•™ìƒ ì´ë¦„ ë§í¬ ìŠ¤íƒ€ì¼ */
        .student-name-link {
            color: #667eea;
            text-decoration: underline;
            cursor: pointer;
            font-weight: bold;
        }
        .student-name-link:hover {
            color: #5568d3;
        }

        /* ì •ë ¬ í—¤ë” ìŠ¤íƒ€ì¼ */
        .sortable-header {
            cursor: pointer;
            user-select: none;
            position: relative;
            padding-right: 20px !important;
        }
        .sortable-header:hover {
            background-color: #f3f4f6;
        }
        .sort-icon {
            display: inline-block;
            margin-left: 5px;
            font-size: 0.8em;
            color: #9ca3af;
        }
        .sortable-header.asc .sort-icon::after { content: 'â–²'; color: #667eea; }
        .sortable-header.desc .sort-icon::after { content: 'â–¼'; color: #667eea; }
        .sortable-header .sort-icon::after { content: 'â†•'; }

        /* ëª¨ë‹¬ ìŠ¤íƒ€ì¼ */
        .modal {
            display: none;
            position: fixed;
            z-index: 1000;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            overflow: auto;
            background-color: rgba(0,0,0,0.5);
            animation: fadeIn 0.3s;
        }
        .modal-content {
            background-color: #fefefe;
            margin: 5% auto;
            padding: 30px;
            border-radius: 15px;
            width: 90%;
            max-width: 1000px;
            box-shadow: 0 4px 20px rgba(0,0,0,0.2);
            position: relative;
            animation: slideIn 0.3s;
        }
        .close-modal {
            color: #aaa;
            float: right;
            font-size: 28px;
            font-weight: bold;
            cursor: pointer;
            transition: color 0.2s;
        }
        .close-modal:hover,
        .close-modal:focus {
            color: #333;
            text-decoration: none;
        }
        
        @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }
        @keyframes slideIn { from { transform: translateY(-20px); opacity: 0; } to { transform: translateY(0); opacity: 1; } }

        /* ë¬¸í•­ ê´€ë¦¬ ìŠ¤íƒ€ì¼ */
        .question-manager-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            flex-wrap: wrap;
            gap: 15px;
        }

        .question-filter-select {
            padding: 10px;
            border: 1px solid #d1d5db;
            border-radius: 8px;
            font-size: 16px;
            min-width: 200px;
        }

        .question-edit-list {
            display: flex;
            flex-direction: column;
            gap: 15px;
        }

        .question-edit-item {
            background: #f9fafb;
            padding: 20px;
            border-radius: 10px;
            border: 1px solid #e5e7eb;
            display: flex;
            gap: 15px;
            align-items: flex-start;
            transition: all 0.3s;
        }

        /* 50ë¬¸í•­ ì„ íƒëœ ì•„ì´í…œ ê°•ì¡° ìŠ¤íƒ€ì¼ */
        .question-edit-item.short-test-selected {
            background: #eff6ff;
            border-color: #667eea;
            box-shadow: 0 4px 6px rgba(102, 126, 234, 0.1);
        }

        .question-id-badge {
            background: #667eea;
            color: white;
            padding: 5px 10px;
            border-radius: 15px;
            font-size: 0.85em;
            font-weight: bold;
            white-space: nowrap;
        }
        
        /* 50ë¬¸í•­ ë±ƒì§€ */
        .short-test-badge {
            background: #10b981;
            color: white;
            padding: 2px 8px;
            border-radius: 10px;
            font-size: 0.75em;
            margin-left: 5px;
            display: none;
        }
        .question-edit-item.short-test-selected .short-test-badge {
            display: inline-block;
        }

        .question-content {
            flex: 1;
            display: flex;
            flex-direction: column;
            gap: 10px;
        }

        .question-options {
            display: flex;
            align-items: center;
            gap: 10px;
            font-size: 0.9em;
            color: #4b5563;
        }

        .question-input {
            width: 100%;
            padding: 10px;
            border: 1px solid #d1d5db;
            border-radius: 6px;
            font-size: 15px;
            transition: border-color 0.2s;
        }

        .question-input:focus {
            outline: none;
            border-color: #667eea;
            box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
        }

        .btn-warning {
            background: #f59e0b;
            color: white;
        }
        .btn-warning:hover {
            background: #d97706;
        }

        @media (max-width: 768px) {
            .header-content {
                flex-direction: column;
                gap: 15px;
                text-align: center;
            }

            .tabs-container {
                overflow-x: auto;
            }

            .stats-grid {
                grid-template-columns: 1fr;
            }

            table {
                font-size: 0.9em;
            }

            th, td {
                padding: 10px;
            }
        }
    </style>
</head>
<body>
    <!-- í—¤ë” -->
    <div class="header">
        <div class="header-content">
            <div>
                <h1>IB í•™ìŠµììƒ ì§„ë‹¨ ê´€ë¦¬ ì‹œìŠ¤í…œ</h1>
                <p class="subtitle">í•™ìƒë“¤ì˜ IB í•™ìŠµììƒ ì§„ë‹¨ ê²°ê³¼ë¥¼ ê´€ë¦¬í•˜ê³  ë¶„ì„í•©ë‹ˆë‹¤</p>
            </div>
            <a href="index.html" class="btn btn-primary">ğŸ¯ í…ŒìŠ¤íŠ¸ í˜ì´ì§€ë¡œ</a>
        </div>
    </div>

    <!-- íƒ­ -->
    <div class="tabs">
        <div class="tabs-container">
            <button class="tab active" data-tab="overview">ğŸ“Š ê°œìš”</button>
            <button class="tab" data-tab="students">ğŸ“‹ í•™ìƒ ëª©ë¡</button>
            <button class="tab" data-tab="statistics">ğŸ“ˆ í†µê³„ ë¶„ì„</button>
            <button class="tab" data-tab="questions">ğŸ“ ë¬¸í•­ ê´€ë¦¬</button>
        </div>
    </div>

    <!-- í•„í„° ë°” -->
    <div class="filter-bar">
        <div class="filter-container">
            <div class="filter-group">
                <label for="grade-filter">ğŸ« í•™ë…„</label>
                <select id="grade-filter">
                    <option value="all">ì „ì²´ í•™ë…„</option>
                </select>
            </div>
            <div class="filter-group">
                <label for="class-filter">ğŸšª ë°˜</label>
                <select id="class-filter">
                    <option value="all">ì „ì²´ ë°˜</option>
                </select>
            </div>
        </div>
    </div>

    <!-- ì½˜í…ì¸  -->
    <div class="content">
        <!-- ê°œìš” íƒ­ -->
        <div id="overview-tab">
            <div class="stats-grid">
                <div class="stat-card blue">
                    <div class="stat-info">
                        <h3>ì´ ì°¸ì—¬ í•™ìƒ</h3>
                        <div class="stat-value" id="total-students">0ëª…</div>
                    </div>
                    <div class="stat-icon blue">ğŸ‘¥</div>
                </div>

                <div class="stat-card green">
                    <div class="stat-info">
                        <h3>í‰ê·  ì™„ë£Œìœ¨</h3>
                        <div class="stat-value">100%</div>
                    </div>
                    <div class="stat-icon green">âœ…</div>
                </div>

                <div class="stat-card purple">
                    <div class="stat-info">
                        <h3>ìµœê·¼ í…ŒìŠ¤íŠ¸</h3>
                        <div class="stat-value" id="recent-test" style="font-size: 1.5em;">-</div>
                    </div>
                    <div class="stat-icon purple">ğŸ“…</div>
                </div>
            </div>

            <div class="card">
                <h2>ğŸ† ë‹¤ìˆ˜ í•™ìŠµììƒ TOP 5</h2>
                <div id="top-profiles" class="profile-list"></div>
            </div>
        </div>

        <!-- í•™ìƒ ëª©ë¡ íƒ­ -->
        <div id="students-tab" class="hidden">
            <div class="card">
                <div class="action-buttons">
                    <button class="btn btn-success" id="export-csv">ğŸ“¥ CSV ë‚´ë³´ë‚´ê¸°</button>
                    <button class="btn btn-danger" id="clear-all">ğŸ—‘ï¸ ì „ì²´ ì‚­ì œ</button>
                </div>

                <h2>ğŸ“‹ í•™ìƒ ëª©ë¡</h2>
                <div id="student-table-container"></div>
            </div>
        </div>

        <!-- í†µê³„ íƒ­ -->
        <div id="statistics-tab" class="hidden">
            <div class="card">
                <h2>ğŸ“Š í•™ìŠµììƒ í‰ê·  ì ìˆ˜ ë¶„í¬</h2>
                <div class="chart-container">
                    <canvas id="radarChart"></canvas>
                </div>
            </div>

            <div class="card">
                <h2>ğŸ“ˆ í•™ìŠµììƒë³„ ìƒì„¸ í†µê³„</h2>
                <div id="detailed-stats"></div>
            </div>
        </div>

        <!-- ë¬¸í•­ ê´€ë¦¬ íƒ­ -->
        <div id="questions-tab" class="hidden">
            <div class="card">
                <div class="question-manager-header">
                    <div style="display: flex; gap: 10px; align-items: center;">
                        <h2>ğŸ“ ì§„ë‹¨ ë¬¸í•­ ê´€ë¦¬</h2>
                        <select id="question-profile-filter" class="question-filter-select">
                            <!-- ì˜µì…˜ì€ JSë¡œ ìƒì„± -->
                        </select>
                    </div>
                    <div class="action-buttons">
                        <button class="btn btn-warning" id="reset-questions-btn">â†º ì´ˆê¸°í™”</button>
                        <button class="btn btn-primary" id="save-questions-btn">ğŸ’¾ ì €ì¥í•˜ê¸°</button>
                    </div>
                </div>
                
                <div class="info-box" style="background: #fffbeb; border: 1px solid #fcd34d; padding: 15px; border-radius: 8px; margin-bottom: 20px; color: #92400e;">
                    âš ï¸ <strong>ì£¼ì˜:</strong> ë¬¸í•­ì„ ìˆ˜ì •í•˜ê³  'ì €ì¥í•˜ê¸°'ë¥¼ ëˆ„ë¥´ë©´ ì‹¤ì œ ê²€ì‚¬ì— ì¦‰ì‹œ ë°˜ì˜ë©ë‹ˆë‹¤. ì´ˆê¸°í™” ë²„íŠ¼ì„ ëˆ„ë¥´ë©´ ëª¨ë“  ë¬¸í•­ì´ ê¸°ë³¸ê°’ìœ¼ë¡œ ë³µêµ¬ë©ë‹ˆë‹¤.
                </div>

                <div id="question-edit-container" class="question-edit-list">
                    <!-- ë¬¸í•­ ë¦¬ìŠ¤íŠ¸ëŠ” JSë¡œ ìƒì„± -->
                </div>
            </div>
        </div>
    </div>

    <!-- ì´ë ¥ ëª¨ë‹¬ -->
    <div id="history-modal" class="modal">
        <div class="modal-content">
            <span class="close-modal">&times;</span>
            <h2 id="modal-student-title" style="margin-bottom: 20px; color: #333;">í•™ìƒ ê¸°ë¡</h2>
            <div id="history-table-container"></div>
        </div>
    </div>

    <script>
        // Google Apps Script ë°°í¬ URL (ì—¬ê¸°ì— ë³µì‚¬í•œ URLì„ ë¶™ì—¬ë„£ìœ¼ì„¸ìš”)
        const GOOGLE_SCRIPT_URL = 'https://script.google.com/macros/s/AKfycbzxzDBrGYJaN5FiBDuDArnr8oy69N1NNl4LA3kwjUXG-LlcFxAAIPW5Ft4ilTopk0Fq/exec';

        // IB í•™ìŠµììƒ ì •ì˜
        const learnerProfiles = {
            inquirer: { name: 'íƒêµ¬í•˜ëŠ” ì‚¬ëŒ', nameEn: 'Inquirers', emoji: 'ğŸ”', color: '#E91E63' },
            knowledgeable: { name: 'ì§€ì‹ì´ í’ë¶€í•œ ì‚¬ëŒ', nameEn: 'Knowledgeable', emoji: 'ğŸ“š', color: '#9C27B0' },
            thinker: { name: 'ì‚¬ê³  í•˜ëŠ” ì‚¬ëŒ', nameEn: 'Thinkers', emoji: 'ğŸ’­', color: '#2196F3' },
            communicator: { name: 'ì†Œí†µí•˜ëŠ” ì‚¬ëŒ', nameEn: 'Communicators', emoji: 'ğŸ’¬', color: '#00BCD4' },
            principled: { name: 'ì›ì¹™ì„ ì§€í‚¤ëŠ” ì‚¬ëŒ', nameEn: 'Principled', emoji: 'âš–ï¸', color: '#009688' },
            openMinded: { name: 'ì—´ë¦° ë§ˆìŒì„ ê°€ì§„ ì‚¬ëŒ', nameEn: 'Open-minded', emoji: 'ğŸŒ', color: '#4CAF50' },
            caring: { name: 'ë°°ë ¤í•˜ëŠ” ì‚¬ëŒ', nameEn: 'Caring', emoji: 'â¤ï¸', color: '#8BC34A' },
            riskTaker: { name: 'ë„ì „í•˜ëŠ” ì‚¬ëŒ', nameEn: 'Risk-takers', emoji: 'ğŸš€', color: '#FF9800' },
            balanced: { name: 'ê· í˜• ì¡íŒ ì‚¬ëŒ', nameEn: 'Balanced', emoji: 'âš–ï¸', color: '#FF5722' },
            reflective: { name: 'ì„±ì°°í•˜ëŠ” ì‚¬ëŒ', nameEn: 'Reflective', emoji: 'ğŸ¤”', color: '#2979FF' }
        };

        // ê¸°ë³¸ ì§ˆë¬¸ ë°ì´í„° (ì´ˆê¸°í™”ìš©)
        const defaultQuestions = [
            // Inquirers
            { id: 1, text: 'ìƒˆë¡œìš´ ê²ƒì„ ë³´ë©´ â€œì™œ ê·¸ëŸ´ê¹Œ?â€ í•˜ëŠ” ë§ˆìŒì´ ë“ ë‹¤.', profile: 'inquirer' },
            { id: 2, text: 'ëª¨ë¥´ëŠ” ê²ƒì´ ìƒê¸°ë©´ ë°”ë¡œ ì•Œì•„ë³´ë ¤ê³  í•œë‹¤.', profile: 'inquirer' },
            { id: 3, text: 'ê³¼ì œë¥¼ í•  ë•Œ ë¨¼ì € ìŠ¤ìŠ¤ë¡œ ì°¾ì•„ë³¸ë‹¤.', profile: 'inquirer' },
            { id: 4, text: 'ì¹œêµ¬ë“¤ ì•ì—ì„œë„ ì§ˆë¬¸ì„ ì˜í•œë‹¤.', profile: 'inquirer' },
            { id: 5, text: 'ê¶ê¸ˆí•œ ê²Œ ìˆìœ¼ë©´ ì˜¤ë˜ ì°¾ì•„ë³´ëŠ” í¸ì´ë‹¤.', profile: 'inquirer' },
            { id: 6, text: 'ë¬¸ì œë¥¼ í’€ ë•Œ ì—¬ëŸ¬ ì±…ì´ë‚˜ ìë£Œë¥¼ ë¹„êµí•´ë³¸ë‹¤.', profile: 'inquirer' },
            { id: 7, text: 'í•œ ê°€ì§€ ìƒê°ë³´ë‹¤ ì—¬ëŸ¬ ìƒê°ì„ ë– ì˜¬ë¦¬ë ¤ í•œë‹¤.', profile: 'inquirer' },
            { id: 8, text: 'ê³µë¶€í•  ë•Œ â€œì™œ ê·¸ëŸ°ì§€ ì´ìœ â€ë¥¼ ì•Œê³  ì‹¶ë‹¤.', profile: 'inquirer' },
            { id: 9, text: 'ì²˜ìŒ ì•Œê²Œëœ ì£¼ì œì— ëŒ€í•´ì„œë„ ê³µë¶€í•˜ê³  ì•Œì•„ë³´ê³  ì‹¶ë‹¤.', profile: 'inquirer' },
            { id: 10, text: 'ìˆ˜ì—…ì´ë‚˜ ëª¨ë‘ ì—ì„œ ì§ˆë¬¸ì„ ìì£¼ í•œë‹¤.', profile: 'inquirer' },
            // Knowledgeable
            { id: 11, text: 'ë°°ìš´ ê²ƒì„ ì„œë¡œ ì´ì–´ì„œ ìƒê°í•˜ë ¤ í•œë‹¤.', profile: 'knowledgeable' },
            { id: 12, text: 'ê²‰ëª¨ì–‘(ê²‰ë³´ê¸°)ë§Œ ì•„ëŠ” ê²ƒë³´ë‹¤ ê¹Šê²Œ ì•„ëŠ” ê²ƒì´ ë” ì¢‹ë‹¤.', profile: 'knowledgeable' },
            { id: 13, text: 'ì¢‹ì•„í•˜ëŠ” ê³µë¶€ë¥¼ ì˜¤ë˜ í•´ë³¸ ì ì´ ìˆë‹¤.', profile: 'knowledgeable' },
            { id: 14, text: 'ë°°ìš´ ê²ƒì„ ì‹¤ì œ ë¬¸ì œì— ì¨ë³´ë ¤ê³  í•œë‹¤.', profile: 'knowledgeable' },
            { id: 15, text: 'ìƒˆë¡œìš´ ì •ë³´ë¥¼ ë“¤ìœ¼ë©´ ì´ë¯¸ ì•„ëŠ” ê²ƒê³¼ ì—°ê²°í•´ë³¸ë‹¤.', profile: 'knowledgeable' },
            { id: 16, text: 'ë‚´ê°€ ì•„ëŠ” ê²ƒì„ ì¹œêµ¬ì—ê²Œ ì„¤ëª…í•˜ëŠ” ê²ƒì´ ì¢‹ë‹¤.', profile: 'knowledgeable' },
            { id: 17, text: 'ìˆ˜ì—…ì´ ëë‚˜ë„ í˜¼ì ë” ì°¾ì•„ë³´ëŠ” í¸ì´ë‹¤.', profile: 'knowledgeable' },
            { id: 18, text: 'ë‹¤ë¥¸ ì˜ˆë¥¼ ë³´ë©° ë¹„ìŠ·í•œ ì ì„ ì°¾ì„ ìˆ˜ ìˆë‹¤.', profile: 'knowledgeable' },
            { id: 19, text: 'ë‚´ê°€ ì¢‹ì•„í•˜ëŠ” ì£¼ì œì˜ ìƒˆ ì†Œì‹ì„ ê´€ì‹¬ ìˆê²Œ ë³¸ë‹¤.', profile: 'knowledgeable' },
            { id: 20, text: 'ë¬¸ì œë¥¼ í’€ ë•Œ ì•Œê³  ìˆëŠ” ì§€ì‹ì„ ì‚¬ìš©í•œë‹¤.', profile: 'knowledgeable' },
            // Thinkers
            { id: 21, text: 'ì–´ë–¤ ì¼ì´ ìƒê¸°ë©´ ë¬´ìŠ¨ ì¼ì´ ì¼ì–´ë‚œ ê²ƒì¸ì§€ ê³°ê³°ì´ ìƒê°í•´ë³¸ë‹¤.', profile: 'thinker' },
            { id: 22, text: 'ì–´ë ¤ìš´ ë¬¸ì œë„ ì°¨ê·¼ì°¨ê·¼ ì‚´í´ë³¸ë‹¤.', profile: 'thinker' },
            { id: 23, text: 'ê²°ì •ì„ í•  ë•Œ ì—¬ëŸ¬ ë°©ë²•ì„ ë¹„êµí•´ë³¸ë‹¤.', profile: 'thinker' },
            { id: 24, text: 'â€œì™œ ì´ë ‡ê²Œ ëì„ê¹Œ?â€ í•˜ê³  ìì£¼ ìƒê°í•œë‹¤.', profile: 'thinker' },
            { id: 25, text: 'ì •ë³´(ì•Œê³  ìˆëŠ” ê²ƒ)ê°€ ë¶€ì¡±í•˜ë©´ ë” ì°¾ì•„ë³¸ë‹¤.', profile: 'thinker' },
            { id: 26, text: 'ë‹¤ì–‘í•œ ê°ì •ì´ ë“œëŠ” ìƒí™©ì—ì„œë„ ì°¨ë¶„íˆ ìƒê°í•˜ë ¤ í•œë‹¤.', profile: 'thinker' },
            { id: 27, text: 'ê³¼ì œë¥¼ í•  ë•Œ ë¨¼ì € ê³„íšì„ ì„¸ìš´ë‹¤.', profile: 'thinker' },
            { id: 28, text: 'ì¹œêµ¬ë“¤ì´ ëª» ë³¸ ì‹¤ìˆ˜ë‚˜ ì˜ëª»ì„ ì˜ ì•Œì•„ì±„ëŠ” í¸ì´ë‹¤.', profile: 'thinker' },
            { id: 29, text: 'ë‹µë³´ë‹¤ ì–´ë–»ê²Œ í’€ì—ˆëŠ”ì§€ ê³¼ì •ì„ ë” ì¤‘ìš”í•˜ê²Œ ìƒê°í•œë‹¤.', profile: 'thinker' },
            { id: 30, text: 'ì–´ë ¤ìš´ ë‚´ìš©ì„ ì‰¬ìš´ ë§ë¡œ ë°”ê¾¸ì–´ ë§í•˜ëŠ” ê±¸ ì¢‹ì•„í•œë‹¤.', profile: 'thinker' },
            // Communicators
            { id: 31, text: 'ë‚´ ë§ì„ ì¹œêµ¬ê°€ ì˜ ì´í•´í•˜ë„ë¡ ë§í•˜ë ¤ í•œë‹¤.', profile: 'communicator' },
            { id: 32, text: 'ë§ì´ ë§í•˜ê¸°ë³´ë‹¤ ì˜ ë“£ëŠ” ê²ƒë„ ì¤‘ìš”í•˜ë‹¤ê³  ìƒê°í•œë‹¤.', profile: 'communicator' },
            { id: 33, text: 'ë°œí‘œí•  ë•Œ ë§ì´ ë–¨ì§€ ì•ŠëŠ”ë‹¤.', profile: 'communicator' },
            { id: 34, text: 'ì¹œêµ¬ ë§ì˜ ì§„ì§œ ëœ»ì„ ìƒê°í•´ë³´ë ¤ê³  í•œë‹¤.', profile: 'communicator' },
            { id: 35, text: 'ì˜ê²¬ì´ ë‹¤ë¥¼ ë•Œë„ ì¡°ìš©íˆ ëŒ€í™”ë¥¼ ì´ì–´ê°€ë ¤ í•œë‹¤.', profile: 'communicator' },
            { id: 36, text: 'ë§Â·ê·¸ë¦¼Â·ê¸€ ë“± ì—¬ëŸ¬ ê°€ì§€ ë°©ë²•ìœ¼ë¡œ ì„¤ëª…í•  ìˆ˜ ìˆë‹¤.', profile: 'communicator' },
            { id: 37, text: 'ëª¨ë‘ ì—ì„œ ì„œë¡œ ë‹¤íˆ´ ë•Œ ì‚¬ì´ì¢‹ê²Œ ë§Œë“¤ë ¤ê³  í•œë‹¤.', profile: 'communicator' },
            { id: 38, text: 'ì§ˆë¬¸ì„ í•  ë•Œ ì‰½ê³  ë¶„ëª…í•˜ê²Œ í•˜ë ¤ê³  í•œë‹¤.', profile: 'communicator' },
            { id: 39, text: 'í† ë¡ í•  ë•Œ ì´ê¸°ë ¤ê³  í•˜ê¸°ë³´ë‹¤ ìƒëŒ€ë°©ì— ëŒ€í•´ ì´í•´í•˜ë ¤ê³  ë…¸ë ¥í•œë‹¤.', profile: 'communicator' },
            { id: 40, text: 'ë°œí‘œ ì¤€ë¹„ë¥¼ í•  ë•Œ ë‚´ìš©ì„ ì˜ ì •ë¦¬í•œë‹¤.', profile: 'communicator' },
            // Principled
            { id: 41, text: 'ì•„ë¬´ë„ ë³´ì§€ ì•Šì•„ë„ ê·œì¹™ì„ ì§€í‚¤ë ¤ê³  í•œë‹¤.', profile: 'principled' },
            { id: 42, text: 'ì •ì§í•˜ê²Œ ë§í•˜ê³  í–‰ë™í•˜ëŠ” ê²ƒì´ ì¤‘ìš”í•˜ë‹¤. (ì •ì§: ê±°ì§“ë§í•˜ì§€ ì•Šê¸°)', profile: 'principled' },
            { id: 43, text: 'ì•½ì†ì„ ê¼­ ì§€í‚¤ë ¤ê³  ë…¸ë ¥í•œë‹¤.', profile: 'principled' },
            { id: 44, text: 'ë§¡ì€ ì¼ì„ ëê¹Œì§€ í•œë‹¤.', profile: 'principled' },
            { id: 45, text: 'ë¶ˆê³µí‰(ê³µì •í•˜ì§€ ì•Šì€)í•œ ì¼ì„ ë³´ë©´ ê·¸ëƒ¥ ì§€ë‚˜ì¹˜ê¸° ì–´ë µë‹¤.', profile: 'principled' },
            { id: 46, text: 'ê³¼ì œë¥¼ í•  ë•Œ ê±°ì§“ë§ë¡œ ê¾¸ë©°ë‚´ê±°ë‚˜ ë‚¨ì„ ì†ì´ì§€ ì•ŠëŠ”ë‹¤.', profile: 'principled' },
            { id: 47, text: 'ë‹¤ë¥¸ ì‚¬ëŒì—ê²Œ í”¼í•´(ë‚˜ìœ ì˜í–¥)ë¥¼ ì£¼ì§€ ì•Šìœ¼ë ¤ í•œë‹¤.', profile: 'principled' },
            { id: 48, text: 'ì˜ëª»í•˜ë©´ ìˆ¨ê¸°ì§€ ì•Šê³  ì¸ì •í•œë‹¤.', profile: 'principled' },
            { id: 49, text: 'ëª¨ë‘ê°€ í•¨ê»˜ ì§€í‚¤ëŠ” ê·œì¹™ì„ ì¤‘ìš”í•˜ê²Œ ìƒê°í•œë‹¤.', profile: 'principled' },
            { id: 50, text: 'ëª¨ë“  ì‚¬ëŒì´ ê°™ì€ ê¸°ì¤€(ê·œì¹™)ìœ¼ë¡œ í‰ê°€ë°›ì•„ì•¼ í•œë‹¤ê³  ìƒê°í•œë‹¤.', profile: 'principled' },
            // Open-minded
            { id: 51, text: 'ë‚˜ì™€ ë‹¤ë¥¸ ì˜ê²¬ì´ ìˆì–´ë„ ì´ìœ ë¥¼ ë¨¼ì € ë“¤ì–´ë³´ë ¤ê³  í•œë‹¤.', profile: 'openMinded' },
            { id: 52, text: 'ë‹¤ë¥¸ ë‚˜ë¼ë‚˜ ë¬¸í™”ê°€ ê¶ê¸ˆí•˜ë‹¤. (ë¬¸í™”: ì‚¬ëŒì´ ì‚¬ëŠ” ë°©ë²•ì´ë‚˜ ëª¨ìŠµ)', profile: 'openMinded' },
            { id: 53, text: 'ë‚´ê°€ í‹€ë¦´ ìˆ˜ë„ ìˆë‹¤ê³  ìƒê°í•˜ëŠ” ê²Œ ì–´ë µì§€ ì•Šë‹¤.', profile: 'openMinded' },
            { id: 54, text: 'ìƒˆ ë°©ë²•ì´ ë‚˜ì˜¤ë©´ í•œ ë²ˆ í•´ë³´ë ¤ í•œë‹¤.', profile: 'openMinded' },
            { id: 55, text: 'ì‚¬ëŒì„ ë§Œë‚  ë•Œ í¸ê²¬(ë¯¸ë¦¬ ì •í•œ ìƒê°) ì—†ì´ ëŒ€í•˜ë ¤ í•œë‹¤.', profile: 'openMinded' },
            { id: 56, text: 'ì˜ê²¬ì´ ë¶€ë”ªí˜€ë„ ìƒëŒ€ì˜ ì…ì¥ì„ ìƒê°í•œë‹¤.', profile: 'openMinded' },
            { id: 57, text: 'ìµìˆ™í•˜ì§€ ì•Šì€ ë‚´ìš©ì„ ì•Œê²Œë˜ë„ ì°¨ë¶„í•˜ê²Œ ì‚´í´ë³´ê³  ìƒê°í•œë‹¤.', profile: 'openMinded' },
            { id: 58, text: 'ë‚˜ì™€ ë‹¤ë¥¸ í–‰ë™ ë°©ì‹ì´ ì´ìƒí•´ ë³´ì—¬ë„ ë¨¼ì € ì´í•´í•˜ë ¤ í•œë‹¤.', profile: 'openMinded' },
            { id: 59, text: 'ìƒˆë¡œìš´ ì–¸ì–´(ë§)ë‚˜ ë¬¸í™”ë¥¼ ë°°ìš°ëŠ” ê²Œ ì¬ë¯¸ìˆë‹¤.', profile: 'openMinded' },
            { id: 60, text: 'í† ë¡ ì—ì„œ ë‚´ê°€ í‹€ë ¸ë‹¤ëŠ” ê±¸ ì¸ì •í•˜ëŠ” ê²ƒì´ ê´œì°®ë‹¤.', profile: 'openMinded' },
            // Caring
            { id: 61, text: 'ì¹œêµ¬ê°€ í˜ë“¤ë©´ ë„ì™€ì£¼ê³  ì‹¶ë‹¤.', profile: 'caring' },
            { id: 62, text: 'ë‹¤íˆ¬ëŠ” ìƒí™©ì—ì„œë„ ìƒëŒ€ë¥¼ ì¡´ì¤‘(ì˜ˆì˜ ìˆê²Œ ëŒ€í•¨)í•˜ë ¤ í•œë‹¤.', profile: 'caring' },
            { id: 63, text: 'ëˆ„êµ°ê°€ ê¸°ë¶„ì´ ì´ìƒí•´ ë³´ì´ë©´ ê¸ˆë°© ëˆˆì¹˜ì±ˆë‹¤.', profile: 'caring' },
            { id: 64, text: 'í•¨ê»˜í•˜ëŠ” ì¼ì„ ìœ„í•´ ë‚´ ì‹œê°„ì„ ì“°ëŠ” ê²ƒì´ ê´œì°®ë‹¤.', profile: 'caring' },
            { id: 65, text: 'ëˆ„ê°€ ë„ì›€ì„ êµ¬í•˜ë©´ ë°”ë¹ ë„ ë„ìš°ë ¤ê³  í•œë‹¤.', profile: 'caring' },
            { id: 66, text: 'ìƒëŒ€ë°©ì˜ ë§ˆìŒì„ ìƒê°í•´ë³´ë ¤ í•œë‹¤.', profile: 'caring' },
            { id: 67, text: 'ì¹œêµ¬ê°€ í˜¼ì ìˆìœ¼ë©´ ì‹ ê²½ ì“°ì¸ë‹¤.', profile: 'caring' },
            { id: 68, text: 'ëª¨ë‘ ì—ì„œ ë¶„ìœ„ê¸°ë¥¼ ì¢‹ê²Œ ë§Œë“¤ë ¤ê³  í•œë‹¤.', profile: 'caring' },
            { id: 69, text: 'ê³ ë§ˆì›€ì„ ìì£¼ í‘œí˜„í•œë‹¤.', profile: 'caring' },
            { id: 70, text: 'ì§€ê¸ˆ ë‹¹ì¥ ë‚˜ì—ê²Œ ì´ìµì´ ì—†ì–´ë„ ë„ìš¸ ìˆ˜ ìˆë‹¤.', profile: 'caring' },
            // Risk-takers
            { id: 71, text: 'ì²˜ìŒ í•˜ëŠ” ì¼ì´ì–´ë„ í•´ë³´ê³  ì‹¶ì€ ë§ˆìŒì´ ë“ ë‹¤.', profile: 'riskTaker' },
            { id: 72, text: 'ì‹¤íŒ¨(ì˜ ì•ˆ ë˜ëŠ” ê²ƒ)í•˜ë”ë¼ë„ ë‹¤ì‹œ í•´ë³´ë ¤ í•œë‹¤.', profile: 'riskTaker' },
            { id: 73, text: 'ë‚¯ì„  ê³³ì´ë‚˜ ì²˜ìŒ ë³´ëŠ” ìƒí™©ì—ì„œë„ ì ì‘í•˜ë ¤ í•œë‹¤.', profile: 'riskTaker' },
            { id: 74, text: 'ë°œí‘œë‚˜ ê²½ìŸ ìƒí™©ì—ë„ ì°¸ì—¬í•˜ë ¤ í•œë‹¤.', profile: 'riskTaker' },
            { id: 75, text: 'ìƒˆë¡œìš´ í™œë™ì„ í•˜ë©´ ì„¤ë Œë‹¤. (ì„¤ë Œë‹¤: ê¸°ë¶„ì´ ë‘ê·¼ë‘ê·¼í•˜ë‹¤)', profile: 'riskTaker' },
            { id: 76, text: 'ë¬¸ì œë¥¼ ë§ˆì£¼í•˜ë©´ í”¼í•˜ì§€ ì•Šê³  í•´ê²°í•˜ë ¤ í•œë‹¤.', profile: 'riskTaker' },
            { id: 77, text: 'ë†’ì€ ëª©í‘œ(í° ê¿ˆ)ë¥¼ ì„¸ìš°ëŠ” ê²Œ ì–´ë µì§€ ì•Šë‹¤.', profile: 'riskTaker' },
            { id: 78, text: 'ì˜ ëª¨ë¥´ëŠ” ìƒí™©ì—ì„œë„ ê²°ì •ì„ í•  ìˆ˜ ìˆë‹¤.', profile: 'riskTaker' },
            { id: 79, text: 'ìƒˆë¡œìš´ ë°©ë²•ì„ ì‹œí—˜í•´ë³´ëŠ” í¸ì´ë‹¤.', profile: 'riskTaker' },
            { id: 80, text: 'ë¹„íŒ(ì•ˆ ì¢‹ì€ ë§)ì„ ë“¤ì„ ìˆ˜ë„ ìˆì–´ë„ ë‚´ ì˜ê²¬ì„ ë§í•œë‹¤.', profile: 'riskTaker' },
            // Balanced
            { id: 81, text: 'ê³µë¶€Â·ì‰¬ê¸°Â·ë†€ê¸° ì‹œê°„ì„ ê³¨ê³ ë£¨ í•˜ë ¤ê³  í•œë‹¤.', profile: 'balanced' },
            { id: 82, text: 'ìŠ¤íŠ¸ë ˆìŠ¤ë¥¼ ë°›ìœ¼ë©´ ìŠ¤ìŠ¤ë¡œ ì¡°ì ˆí•˜ë ¤ í•œë‹¤.', profile: 'balanced' },
            { id: 83, text: 'ëª¸ ì“°ëŠ” ì¼ê³¼ ìƒê°í•˜ëŠ” ì¼ì„ ê· í˜• ìˆê²Œ í•˜ë ¤ê³  í•œë‹¤.', profile: 'balanced' },
            { id: 84, text: 'ì¹œêµ¬Â·ê°€ì¡±Â·í•™êµ ìƒí™œì„ ê³ ë¥´ê²Œ ì±™ê¸°ë ¤ê³  í•œë‹¤.', profile: 'balanced' },
            { id: 85, text: 'ì‹œê°„ì´ ë¶€ì¡±í•˜ë©´ ìš°ì„ ìˆœìœ„(ë¨¼ì € í•  ê²ƒ)ë¥¼ ì •í•œë‹¤.', profile: 'balanced' },
            { id: 86, text: 'í•œ ê°€ì§€ì— ë„ˆë¬´ ëª°ë‘(ë„ˆë¬´ ë¹ ì ¸ë²„ë¦¼)í•˜ì§€ ì•Šìœ¼ë ¤ê³  í•œë‹¤.', profile: 'balanced' },
            { id: 87, text: 'ìš´ë™ì´ë‚˜ ì‰¬ëŠ” ì‹œê°„ì„ ì±™ê¸°ë ¤ê³  í•œë‹¤.', profile: 'balanced' },
            { id: 88, text: 'í•™ìƒÂ·ì¹œêµ¬Â·ê°€ì¡± ì—­í• ì„ ê· í˜• ìˆê²Œ í•˜ë ¤ê³  í•œë‹¤.', profile: 'balanced' },
            { id: 89, text: 'ë§ˆìŒì´ í˜ë“¤ë©´ ë„ì›€ì„ ìš”ì²­í•  ìˆ˜ ìˆë‹¤.', profile: 'balanced' },
            { id: 90, text: 'ê·œì¹™ì ì¸ ìƒí™œ(ë§¤ì¼ ë¹„ìŠ·í•˜ê²Œ í•˜ëŠ” ìƒí™œ)ì´ ì¤‘ìš”í•˜ë‹¤ê³  ìƒê°í•œë‹¤.', profile: 'balanced' },
            // Reflective
            { id: 91, text: 'í•˜ë£¨ê°€ ëë‚˜ë©´ ì˜¤ëŠ˜ í•œ ì¼ì„ ë– ì˜¬ë ¤ë³¸ë‹¤.', profile: 'reflective' },
            { id: 92, text: 'ì˜í•œ ì Â·ê³ ì¹  ì ì„ ìŠ¤ìŠ¤ë¡œ ìƒê°í•´ë³¸ë‹¤.', profile: 'reflective' },
            { id: 93, text: 'ì‹¤ìˆ˜í•˜ë©´ â€œì™œ ê·¸ë¬ì„ê¹Œ?â€ í•˜ê³  ìƒê°í•œë‹¤.', profile: 'reflective' },
            { id: 94, text: 'ê³µë¶€ë‚˜ í™œë™ì´ ëë‚œ ë’¤ ë‹¤ì‹œ ë˜ëŒì•„ë³¸ë‹¤.', profile: 'reflective' },
            { id: 95, text: 'ì–´ë–¤ ê³µë¶€ ë°©ë²•ì´ ë‚˜ì—ê²Œ ë§ëŠ”ì§€ ê³ ë¯¼í•œë‹¤.', profile: 'reflective' },
            { id: 96, text: 'ëª©í‘œ(í•˜ê³  ì‹¶ì€ ê²ƒ)ë¥¼ ì„¸ìš°ê³  ì˜ ë˜ëŠ”ì§€ í™•ì¸í•œë‹¤.', profile: 'reflective' },
            { id: 97, text: 'ë‚´ ê°ì •ì´ ì™œ ìƒê²¼ëŠ”ì§€ ìƒê°í•´ë³¸ë‹¤.', profile: 'reflective' },
            { id: 98, text: 'ì¹œêµ¬ì™€ ë‹¤íˆ¬ë©´ ë‚´ í–‰ë™ì„ ë¨¼ì € ëŒì•„ë³¸ë‹¤.', profile: 'reflective' },
            { id: 99, text: 'ê²°ê³¼ë³´ë‹¤ ë°°ìš°ëŠ” ê³¼ì •ì´ ë” ì¤‘ìš”í•˜ë‹¤ê³  ëŠë‚€ë‹¤.', profile: 'reflective' },
            { id: 100, text: 'ë‚´ í–‰ë™ ìŠµê´€(ìì£¼ í•˜ëŠ” í–‰ë™)ì„ ì•Œì•„ë³´ë ¤ê³  í•œë‹¤.', profile: 'reflective' }
        ];

        let results = [];
        let currentQuestions = []; // í˜„ì¬ í¸ì§‘ ì¤‘ì¸ ì§ˆë¬¸ ëª©ë¡
        let radarChartInstance = null;
        let currentSort = { field: null, direction: 'asc' }; // ë©”ì¸ ëª©ë¡ ì •ë ¬ ìƒíƒœ
        let modalSort = { field: 'date', direction: 'desc' }; // ëª¨ë‹¬ ëª©ë¡ ì •ë ¬ ìƒíƒœ (ê¸°ë³¸ê°’: ìµœì‹ ìˆœ)

        // í•„í„° ì´ˆê¸°í™”
        function initFilters() {
            const gradeSelect = document.getElementById('grade-filter');
            const classSelect = document.getElementById('class-filter');
            
            // í˜„ì¬ ì„ íƒëœ ê°’ ì €ì¥ (ë¦¬ë¡œë“œ ì‹œ ìœ ì§€ ìœ„í•¨)
            const currentGrade = gradeSelect.value;
            const currentClass = classSelect.value;

            // í•™ë…„ ëª©ë¡ ì¶”ì¶œ ë° ì •ë ¬
            const grades = [...new Set(results.map(r => r.grade).filter(Boolean))].sort((a, b) => a - b);
            
            // ë°˜ ëª©ë¡ ì¶”ì¶œ ë° ì •ë ¬
            const classes = [...new Set(results.map(r => r.class).filter(Boolean))].sort((a, b) => a - b);

            // ì˜µì…˜ ì¬ìƒì„±
            gradeSelect.innerHTML = '<option value="all">ì „ì²´ í•™ë…„</option>';
            grades.forEach(g => {
                const option = document.createElement('option');
                option.value = g;
                option.textContent = `${g}í•™ë…„`;
                gradeSelect.appendChild(option);
            });

            classSelect.innerHTML = '<option value="all">ì „ì²´ ë°˜</option>';
            classes.forEach(c => {
                const option = document.createElement('option');
                option.value = c;
                option.textContent = `${c}ë°˜`;
                classSelect.appendChild(option);
            });

            // ê°’ ë³µì› (ì˜µì…˜ì´ ì¡´ì¬í•  ê²½ìš°ì—ë§Œ)
            if (grades.includes(currentGrade)) gradeSelect.value = currentGrade;
            if (classes.includes(currentClass)) classSelect.value = currentClass;
        }

        // í•„í„°ë§ëœ ê²°ê³¼ ê°€ì ¸ì˜¤ê¸°
        function getFilteredResults() {
            const gradeFilter = document.getElementById('grade-filter').value;
            const classFilter = document.getElementById('class-filter').value;

            return results.filter(r => {
                const matchGrade = gradeFilter === 'all' || r.grade.toString() === gradeFilter;
                const matchClass = classFilter === 'all' || r.class.toString() === classFilter;
                return matchGrade && matchClass;
            });
        }

        // í•„í„° ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ
        document.getElementById('grade-filter').addEventListener('change', updateDashboard);
        document.getElementById('class-filter').addEventListener('change', updateDashboard);

        function updateDashboard() {
            const activeTab = document.querySelector('.tab.active').dataset.tab;
            if (activeTab === 'overview') renderOverview();
            else if (activeTab === 'students') renderStudentList();
            else if (activeTab === 'statistics') renderStatistics();
        }

        // ë°ì´í„° ë¡œë“œ
        async function loadResults() {
            try {
                if (GOOGLE_SCRIPT_URL) {
                    const response = await fetch(GOOGLE_SCRIPT_URL);
                    const data = await response.json();
                    results = data;
                } else {
                    // URLì´ ì—†ìœ¼ë©´ ë¡œì»¬ ìŠ¤í† ë¦¬ì§€ ì‚¬ìš©
                    results = JSON.parse(localStorage.getItem('ibTestResults') || '[]');
                }
                initFilters();
                updateDashboard(); // ë°ì´í„° ë¡œë“œ í›„ ëŒ€ì‹œë³´ë“œ ì—…ë°ì´íŠ¸
            } catch (e) {
                console.error('Failed to load results', e);
                alert('ë°ì´í„°ë¥¼ ë¶ˆëŸ¬ì˜¤ëŠ”ë° ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤. ë¡œì»¬ ë°ì´í„°ë¥¼ ì‹œë„í•©ë‹ˆë‹¤.');
                results = JSON.parse(localStorage.getItem('ibTestResults') || '[]');
                initFilters();
                updateDashboard();
            }
        }

        // ì§ˆë¬¸ ë°ì´í„° ë¡œë“œ
        async function loadQuestions() {
            try {
                // 1. êµ¬ê¸€ ì‹œíŠ¸ì—ì„œ ë¶ˆëŸ¬ì˜¤ê¸° ì‹œë„
                if (GOOGLE_SCRIPT_URL) {
                    // 5ì´ˆ íƒ€ì„ì•„ì›ƒ ì„¤ì •
                    const controller = new AbortController();
                    const timeoutId = setTimeout(() => controller.abort(), 5000);

                    try {
                        const response = await fetch(GOOGLE_SCRIPT_URL + '?type=questions', {
                            signal: controller.signal
                        });
                        clearTimeout(timeoutId);
                        
                        const data = await response.json();
                        
                        if (data && data.length > 0) {
                            currentQuestions = data;
                            console.log('Google Sheetì—ì„œ ë¬¸í•­ ë¡œë“œ ì™„ë£Œ: ' + currentQuestions.length + 'ê°œ');
                        } else {
                            throw new Error('Google Sheetì— ë¬¸í•­ ë°ì´í„°ê°€ ì—†ìŒ (ë¹ˆ ë°°ì—´)');
                        }
                    } catch (fetchError) {
                        if (fetchError.name === 'AbortError') {
                            console.warn('Google Sheet ë¡œë“œ ì‹œê°„ ì´ˆê³¼ (5ì´ˆ)');
                        } else {
                            console.warn('Google Sheet ë¡œë“œ ì‹¤íŒ¨:', fetchError);
                        }
                        throw fetchError; // catch ë¸”ë¡ìœ¼ë¡œ ë„˜ê¹€
                    }
                } else {
                    throw new Error('Google Script URLì´ ì„¤ì •ë˜ì§€ ì•ŠìŒ');
                }
            } catch (e) {
                console.log('ë¡œì»¬/ê¸°ë³¸ê°’ ì‚¬ìš©ìœ¼ë¡œ ì „í™˜:', e);
                // 2. ì‹¤íŒ¨ ì‹œ ë¡œì»¬ ìŠ¤í† ë¦¬ì§€ í™•ì¸
                const stored = JSON.parse(localStorage.getItem('ibTestQuestions'));
                if (stored && stored.length > 0) {
                    currentQuestions = stored;
                    console.log('ë¡œì»¬ ìŠ¤í† ë¦¬ì§€ì—ì„œ ë¬¸í•­ ë¡œë“œ ì™„ë£Œ: ' + currentQuestions.length + 'ê°œ');
                } else {
                    // 3. ë¡œì»¬ë„ ì—†ìœ¼ë©´ ê¸°ë³¸ê°’ ì‚¬ìš©
                    currentQuestions = JSON.parse(JSON.stringify(defaultQuestions));
                    console.log('ê¸°ë³¸ ë¬¸í•­(Default) ë¡œë“œ ì™„ë£Œ: ' + currentQuestions.length + 'ê°œ');
                }
                
                // ë°ì´í„° ë§ˆì´ê·¸ë ˆì´ì…˜ ë° ì´ˆê¸°í™” ë¡œì§
                const profileCounts = {};
                currentQuestions.forEach(q => {
                    if (q.useForShortTest === undefined) {
                        profileCounts[q.profile] = (profileCounts[q.profile] || 0) + 1;
                        q.useForShortTest = profileCounts[q.profile] <= 5;
                    }
                });
            }
        }

        // ì§ˆë¬¸ í•„í„° ì˜µì…˜ ì´ˆê¸°í™”
        function initQuestionFilter() {
            const select = document.getElementById('question-profile-filter');
            select.innerHTML = '';
            
            Object.entries(learnerProfiles).forEach(([key, profile]) => {
                const option = document.createElement('option');
                option.value = key;
                option.textContent = `${profile.emoji} ${profile.name}`;
                select.appendChild(option);
            });

            // ì²« ë²ˆì§¸ ì˜µì…˜ ê°•ì œ ì„ íƒ
            if (select.options.length > 0) {
                select.selectedIndex = 0;
            }

            // ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ
            select.addEventListener('change', renderQuestionEditor);
        }

        // ì§ˆë¬¸ ì—ë””í„° ë Œë”ë§
        function renderQuestionEditor() {
            const container = document.getElementById('question-edit-container');
            let selectedProfile = document.getElementById('question-profile-filter').value;
            
            // ì„ íƒëœ ê°’ì´ ì—†ìœ¼ë©´ ì²« ë²ˆì§¸ ê°’ìœ¼ë¡œ ì‹œë„
            if (!selectedProfile && document.getElementById('question-profile-filter').options.length > 0) {
                selectedProfile = document.getElementById('question-profile-filter').options[0].value;
                document.getElementById('question-profile-filter').value = selectedProfile;
            }

            if (!selectedProfile) {
                container.innerHTML = '<div class="empty-state">í•™ìŠµììƒ í”„ë¡œí•„ì„ ì„ íƒí•´ì£¼ì„¸ìš”.</div>';
                return;
            }
            
            // ë°ì´í„°ê°€ ì—†ëŠ” ê²½ìš° ì²˜ë¦¬
            if (!currentQuestions || currentQuestions.length === 0) {
                container.innerHTML = '<div class="empty-state">ë¶ˆëŸ¬ì˜¨ ë¬¸í•­ ë°ì´í„°ê°€ ì—†ìŠµë‹ˆë‹¤. (ì´ˆê¸°í™” ë²„íŠ¼ì„ ëˆŒëŸ¬ë³´ì„¸ìš”)</div>';
                return;
            }

            // ì„ íƒëœ í”„ë¡œí•„ì˜ ì§ˆë¬¸ë§Œ í•„í„°ë§
            const filteredQuestions = currentQuestions.filter(q => q.profile === selectedProfile);
            
            if (filteredQuestions.length === 0) {
                container.innerHTML = `<div class="empty-state">
                    '${learnerProfiles[selectedProfile]?.name || selectedProfile}'ì— í•´ë‹¹í•˜ëŠ” ë¬¸í•­ì´ ì—†ìŠµë‹ˆë‹¤.
                </div>`;
                return;
            }
            
            container.innerHTML = filteredQuestions.map(q => `
                <div class="question-edit-item ${q.useForShortTest ? 'short-test-selected' : ''}">
                    <div>
                        <span class="question-id-badge">ë¬¸í•­ ${q.id}</span>
                        <span class="short-test-badge">50ë¬¸í•­ í¬í•¨</span>
                    </div>
                    <div class="question-content">
                        <input type="text" class="question-input" 
                            value="${q.text}" 
                            data-id="${q.id}"
                            onchange="updateQuestionText(${q.id}, this.value)">
                        <div class="question-options">
                            <label style="display: flex; align-items: center; gap: 5px; cursor: pointer;">
                                <input type="checkbox" 
                                    ${q.useForShortTest ? 'checked' : ''} 
                                    onchange="updateShortTestStatus(${q.id}, this.checked)">
                                50ë¬¸í•­(ì•½ì‹) ê²€ì‚¬ì— í¬í•¨í•˜ê¸°
                            </label>
                        </div>
                    </div>
                </div>
            `).join('');
        }

        // ì§ˆë¬¸ í…ìŠ¤íŠ¸ ì—…ë°ì´íŠ¸ (ë©”ëª¨ë¦¬ ìƒ)
        window.updateQuestionText = function(id, newText) {
            const question = currentQuestions.find(q => q.id === id);
            if (question) {
                question.text = newText;
            }
        };

        // 50ë¬¸í•­ í¬í•¨ ì—¬ë¶€ ì—…ë°ì´íŠ¸
        window.updateShortTestStatus = function(id, isChecked) {
            const question = currentQuestions.find(q => q.id === id);
            if (question) {
                // í•´ë‹¹ í”„ë¡œí•„ì˜ í˜„ì¬ ì„ íƒëœ ê°œìˆ˜ í™•ì¸
                const profileQuestions = currentQuestions.filter(q => q.profile === question.profile);
                const currentSelectedCount = profileQuestions.filter(q => q.useForShortTest).length;

                if (isChecked) {
                    // ì²´í¬í•˜ë ¤ëŠ” ê²½ìš°: 5ê°œë¥¼ ì´ˆê³¼í•˜ëŠ”ì§€ í™•ì¸
                    if (currentSelectedCount >= 5) {
                        alert('ê° í•™ìŠµììƒë‹¹ ìµœëŒ€ 5ê°œì˜ ë¬¸í•­ë§Œ 50ë¬¸í•­ ê²€ì‚¬ì— í¬í•¨í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.\në‹¤ë¥¸ ë¬¸í•­ì˜ ì²´í¬ë¥¼ í•´ì œí•œ í›„ ë‹¤ì‹œ ì‹œë„í•´ì£¼ì„¸ìš”.');
                        // ì²´í¬ë°•ìŠ¤ ìƒíƒœ ë˜ëŒë¦¬ê¸° (UI ê°±ì‹ ì„ ìœ„í•´ ì¬ë Œë”ë§)
                        renderQuestionEditor();
                        return;
                    }
                    question.useForShortTest = true;
                } else {
                    // ì²´í¬ í•´ì œí•˜ë ¤ëŠ” ê²½ìš°: ìµœì†Œ 1ê°œëŠ” ìˆì–´ì•¼ í•˜ëŠ” ë“±ì˜ ì œì•½ì´ í•„ìš”í•˜ë‹¤ë©´ ì¶”ê°€
                    question.useForShortTest = false;
                }
                
                // UI ê°±ì‹  (ìŠ¤íƒ€ì¼ ì ìš©ì„ ìœ„í•´)
                renderQuestionEditor();
            }
        };

        // ì§ˆë¬¸ ì €ì¥
        document.getElementById('save-questions-btn').addEventListener('click', async () => {
            if (confirm('ìˆ˜ì •ëœ ë¬¸í•­ì„ ì €ì¥í•˜ì‹œê² ìŠµë‹ˆê¹Œ? ì €ì¥ ì¦‰ì‹œ ì‹¤ì œ ê²€ì‚¬ì— ë°˜ì˜ë©ë‹ˆë‹¤.')) {
                // 1. ë¡œì»¬ ìŠ¤í† ë¦¬ì§€ì— ì €ì¥ (ë°±ì—… ë° ì˜¤í”„ë¼ì¸ìš©)
                localStorage.setItem('ibTestQuestions', JSON.stringify(currentQuestions));
                
                // 2. êµ¬ê¸€ ì‹œíŠ¸ì— ì €ì¥
                if (GOOGLE_SCRIPT_URL) {
                    try {
                        const btn = document.getElementById('save-questions-btn');
                        const originalText = btn.textContent;
                        btn.textContent = 'ì €ì¥ ì¤‘...';
                        btn.disabled = true;

                        await fetch(GOOGLE_SCRIPT_URL, {
                            method: 'POST',
                            mode: 'no-cors',
                            headers: { 'Content-Type': 'application/json' },
                            body: JSON.stringify({
                                action: 'saveQuestions',
                                questions: currentQuestions
                            })
                        });
                        
                        alert('ë¬¸í•­ì´ êµ¬ê¸€ ì‹œíŠ¸ì— ì„±ê³µì ìœ¼ë¡œ ì €ì¥ë˜ì—ˆìŠµë‹ˆë‹¤.');
                        btn.textContent = originalText;
                        btn.disabled = false;
                    } catch (e) {
                        console.error('Google Sheet save error:', e);
                        alert('êµ¬ê¸€ ì‹œíŠ¸ ì €ì¥ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤. (ë¡œì»¬ì—ëŠ” ì €ì¥ë¨)');
                    }
                } else {
                    alert('ë¬¸í•­ì´ ë¡œì»¬ì— ì €ì¥ë˜ì—ˆìŠµë‹ˆë‹¤. (êµ¬ê¸€ ì‹œíŠ¸ URL ì—†ìŒ)');
                }
            }
        });

        // ì§ˆë¬¸ ì´ˆê¸°í™”
        document.getElementById('reset-questions-btn').addEventListener('click', () => {
            if (confirm('ëª¨ë“  ë¬¸í•­ì„ ê¸°ë³¸ê°’ìœ¼ë¡œ ì´ˆê¸°í™”í•˜ì‹œê² ìŠµë‹ˆê¹Œ? ì´ ì‘ì—…ì€ ë˜ëŒë¦´ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.')) {
                localStorage.removeItem('ibTestQuestions');
                loadQuestions(); // ë‹¤ì‹œ ë¡œë“œ (ê¸°ë³¸ê°’ìœ¼ë¡œ)
                renderQuestionEditor(); // í™”ë©´ ê°±ì‹ 
                alert('ëª¨ë“  ë¬¸í•­ì´ ì´ˆê¸°í™”ë˜ì—ˆìŠµë‹ˆë‹¤.');
            }
        });

        // íƒ­ ì „í™˜
        document.querySelectorAll('.tab').forEach(tab => {
            tab.addEventListener('click', async () => {
                document.querySelectorAll('.tab').forEach(t => t.classList.remove('active'));
                tab.classList.add('active');

                const tabName = tab.dataset.tab;
                document.getElementById('overview-tab').classList.add('hidden');
                document.getElementById('students-tab').classList.add('hidden');
                document.getElementById('statistics-tab').classList.add('hidden');
                document.getElementById('questions-tab').classList.add('hidden'); // ê¸°ì¡´ íƒ­ ìˆ¨ê¹€ ì¶”ê°€
                
                document.getElementById(`${tabName}-tab`).classList.remove('hidden');

                // íƒ­ ì „í™˜ ì‹œ í˜„ì¬ í•„í„° ìƒíƒœì— ë§ì¶° ë Œë”ë§
                if (tabName === 'overview') renderOverview();
                else if (tabName === 'students') renderStudentList();
                else if (tabName === 'statistics') renderStatistics();
                else if (tabName === 'questions') {
                    // ë¡œë”© í‘œì‹œ
                    const container = document.getElementById('question-edit-container');
                    container.innerHTML = '<div style="text-align:center; padding: 50px; color: #666;">ë°ì´í„°ë¥¼ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘ì…ë‹ˆë‹¤...<br>ì ì‹œë§Œ ê¸°ë‹¤ë ¤ì£¼ì„¸ìš”.</div>';
                    
                    await loadQuestions(); // íƒ­ ì—´ ë•Œ ìµœì‹  ë°ì´í„° ë¡œë“œ (ë™ê¸°í™”)
                    renderQuestionEditor(); // ì—ë””í„° ë Œë”ë§
                }
            });
        });

        // ê°œìš” ë Œë”ë§
        function renderOverview() {
            const filteredData = getFilteredResults();
            document.getElementById('total-students').textContent = `${filteredData.length}ëª…`;
            
            if (filteredData.length > 0) {
                // ë‚ ì§œìˆœ ì •ë ¬ í›„ ê°€ì¥ ìµœê·¼ ê²ƒ ê°€ì ¸ì˜¤ê¸°
                const sortedByDate = [...filteredData].sort((a, b) => new Date(b.date) - new Date(a.date));
                const lastTest = new Date(sortedByDate[0].date);
                document.getElementById('recent-test').textContent = lastTest.toLocaleDateString('ko-KR');
            } else {
                document.getElementById('recent-test').textContent = '-';
            }

            // TOP 5 í•™ìŠµììƒ
            const topProfiles = getTopProfiles(filteredData);
            const topProfilesHtml = topProfiles.length > 0 ? topProfiles.map(([profile, count], index) => {
                const profileData = learnerProfiles[profile];
                const maxCount = topProfiles[0][1];
                const percentage = (count / maxCount) * 100;
                return `
                    <div class="profile-item">
                        <span class="profile-name">${index + 1}. ${profileData.emoji} ${profileData.name}</span>
                        <div class="profile-bar-container">
                            <div class="profile-bar">
                                <div class="profile-bar-fill" style="width: ${percentage}%; background-color: ${profileData.color};"></div>
                            </div>
                        </div>
                        <span class="profile-score" style="color: ${profileData.color};">${count}ì </span>
                    </div>
                `;
            }).join('') : '<div class="empty-state"><div class="empty-state-icon">ğŸ“­</div><p>í•´ë‹¹ ì¡°ê±´ì˜ ë°ì´í„°ê°€ ì—†ìŠµë‹ˆë‹¤.</p></div>';

            document.getElementById('top-profiles').innerHTML = topProfilesHtml;
        }

        function getTopProfiles(data) {
            if (data.length === 0) return [];

            const profileCounts = {};
            Object.keys(learnerProfiles).forEach(profile => {
                profileCounts[profile] = 0;
            });

            data.forEach(result => {
                // ìƒìœ„ 4ê°œê¹Œì§€ ë°˜ì˜
                const tops = result.topProfiles || [];
                tops.slice(0, 4).forEach((profile, index) => {
                    if (index === 0) profileCounts[profile[0]] += 4;      // 1ìœ„: 4ì 
                    else if (index === 1) profileCounts[profile[0]] += 3; // 2ìœ„: 3ì 
                    else if (index === 2) profileCounts[profile[0]] += 2; // 3ìœ„: 2ì 
                    else if (index === 3) profileCounts[profile[0]] += 1; // 4ìœ„: 1ì 
                });
            });

            return Object.entries(profileCounts)
                .sort((a, b) => b[1] - a[1])
                .slice(0, 5);
        }

        // í•™ìƒ ëª©ë¡ ë Œë”ë§
        function renderStudentList() {
            // 1. í•„í„°ë§
            let filteredData = getFilteredResults();
            
            if (filteredData.length === 0) {
                document.getElementById('student-table-container').innerHTML = `
                    <div class="empty-state">
                        <div class="empty-state-icon">ğŸ“­</div>
                        <p>í•´ë‹¹ ì¡°ê±´ì˜ í•™ìƒ ë°ì´í„°ê°€ ì—†ìŠµë‹ˆë‹¤.</p>
                    </div>
                `;
                return;
            }

            // 2. ì¤‘ë³µ ì œê±° (ì´ë¦„+í•™ë…„+ë°˜ ê¸°ì¤€ ìµœì‹  ë°ì´í„°ë§Œ ìœ ì§€)
            // ë‹¨, ì „ì²´ ì‚­ì œë‚˜ CSV ë‚´ë³´ë‚´ê¸° ë“±ì€ ì „ì²´ ë°ì´í„°ë¥¼ ëŒ€ìƒìœ¼ë¡œ í•  ìˆ˜ë„ ìˆìœ¼ë‚˜,
            // ëª©ë¡ ë³´ê¸°ì—ì„œëŠ” "í•™ìƒ í˜„í™©"ì„ ë³´ëŠ” ê²ƒì´ë¯€ë¡œ ìµœì‹ ë§Œ ë³´ì—¬ì¤Œ.
            const uniqueStudents = {};
            filteredData.forEach(item => {
                const key = `${item.grade}-${item.class}-${item.name}-${item.number}`;
                if (!uniqueStudents[key] || new Date(item.date) > new Date(uniqueStudents[key].date)) {
                    uniqueStudents[key] = item;
                }
            });
            let displayData = Object.values(uniqueStudents);

            // 3. ì •ë ¬ ë¡œì§
            displayData.sort((a, b) => {
                // 3-1. ì‚¬ìš©ì ì§€ì • ì •ë ¬
                if (currentSort.field) {
                    let valA = a[currentSort.field];
                    let valB = b[currentSort.field];

                    // ìˆ«ìí˜• ë°ì´í„° ë³€í™˜
                    if (['grade', 'class', 'number'].includes(currentSort.field)) {
                        valA = parseInt(valA) || 0;
                        valB = parseInt(valB) || 0;
                    } else if (currentSort.field === 'date') {
                        valA = new Date(valA);
                        valB = new Date(valB);
                    }

                    if (valA < valB) return currentSort.direction === 'asc' ? -1 : 1;
                    if (valA > valB) return currentSort.direction === 'asc' ? 1 : -1;
                    return 0;
                }
                
                // 3-2. ê¸°ë³¸ ì •ë ¬ (ì‚¬ìš©ì ì§€ì • ì •ë ¬ì´ ì—†ì„ ë•Œ)
                const classFilter = document.getElementById('class-filter').value;
                if (classFilter !== 'all') {
                    // ë°˜ì´ ì„ íƒëœ ê²½ìš°: ë²ˆí˜¸ ì˜¤ë¦„ì°¨ìˆœ
                    return (parseInt(a.number) || 0) - (parseInt(b.number) || 0);
                } else {
                    // ì „ì²´/í•™ë…„ ë³´ê¸°: í•™ë…„ -> ë°˜ -> ë²ˆí˜¸ ì˜¤ë¦„ì°¨ìˆœ
                    if (a.grade != b.grade) return (parseInt(a.grade) || 0) - (parseInt(b.grade) || 0);
                    if (a.class != b.class) return (parseInt(a.class) || 0) - (parseInt(b.class) || 0);
                    return (parseInt(a.number) || 0) - (parseInt(b.number) || 0);
                }
            });

            // í—¤ë” ìƒì„± í•¨ìˆ˜ (ì •ë ¬ ì•„ì´ì½˜ í¬í•¨)
            const createHeader = (field, text) => {
                let className = 'sortable-header';
                if (currentSort.field === field) {
                    className += ` ${currentSort.direction}`;
                }
                return `<th class="${className}" onclick="handleSort('${field}')">${text} <span class="sort-icon"></span></th>`;
            };

            const tableHtml = `
                <table>
                    <thead>
                        <tr>
                            ${createHeader('name', 'ì´ë¦„')}
                            ${createHeader('grade', 'í•™ë…„')}
                            ${createHeader('class', 'ë°˜')}
                            ${createHeader('number', 'ë²ˆí˜¸')}
                            ${createHeader('date', 'ìµœê·¼ í…ŒìŠ¤íŠ¸ ë‚ ì§œ')}
                            <th>ìœ í˜•</th>
                            <th>ìƒìœ„ í•™ìŠµììƒ</th>
                            <th>ì‘ì—…</th>
                        </tr>
                    </thead>
                    <tbody>
                        ${displayData.map((result) => {
                            // ì›ë³¸ ë°°ì—´ì—ì„œì˜ ì¸ë±ìŠ¤ ì°¾ê¸° (ì‚­ì œ ê¸°ëŠ¥ì„ ìœ„í•´ - ìµœì‹  ë°ì´í„° ê¸°ì¤€)
                            // ì£¼ì˜: ì¤‘ë³µ ì œê±°ëœ ë·°ì—ì„œ ì‚­ì œ ì‹œ í•´ë‹¹ í•™ìƒì˜ 'ìµœì‹  ê¸°ë¡'ë§Œ ì‚­ì œí• ì§€ ê³ ë¯¼ í•„ìš”.
                            // ì—¬ê¸°ì„œëŠ” ë¦¬ìŠ¤íŠ¸ì— ë³´ì´ëŠ” í•­ëª©(ìµœì‹ )ì„ ì‚­ì œí•˜ë„ë¡ í•¨.
                            const originalIndex = results.indexOf(result);
                            
                            return `
                            <tr>
                                <td>
                                    <span class="student-name-link" onclick="openHistoryModal('${result.name}', '${result.grade}', '${result.class}', '${result.number}')">
                                        ${result.name}
                                    </span>
                                </td>
                                <td>${result.grade}í•™ë…„</td>
                                <td>${result.class}ë°˜</td>
                                <td>${result.number}ë²ˆ</td>
                                <td>${new Date(result.date).toLocaleString('ko-KR')}</td>
                                <td><span class="tag" style="background: #f3f4f6; color: #4b5563;">${result.testType || 100}ë¬¸í•­</span></td>
                                <td>
                                    ${(result.topProfiles || []).slice(0, 4).map(([profile, score]) => {
                                        const profileData = learnerProfiles[profile];
                                        return `<span class="tag" style="background-color: ${profileData.color}20; color: ${profileData.color};">
                                            ${profileData.emoji} ${profileData.name} (${score}%)
                                        </span>`;
                                    }).join('')}
                                </td>
                                <td>
                                    <button class="btn btn-danger" style="padding: 5px 10px; font-size: 0.9em;" onclick="deleteResult(${originalIndex})">ì‚­ì œ</button>
                                </td>
                            </tr>
                        `}).join('')}
                    </tbody>
                </table>
            `;
            document.getElementById('student-table-container').innerHTML = tableHtml;
        }

        // ì •ë ¬ í•¸ë“¤ëŸ¬
        function handleSort(field) {
            if (currentSort.field === field) {
                // ê°™ì€ í•„ë“œ í´ë¦­ ì‹œ ë°©í–¥ í† ê¸€
                currentSort.direction = currentSort.direction === 'asc' ? 'desc' : 'asc';
            } else {
                // ìƒˆë¡œìš´ í•„ë“œ í´ë¦­ ì‹œ ì˜¤ë¦„ì°¨ìˆœ ì‹œì‘
                currentSort.field = field;
                currentSort.direction = 'asc';
            }
            renderStudentList();
        }

        // ì´ë ¥ ëª¨ë‹¬ ì—´ê¸°
        function openHistoryModal(name, grade, studentClass, number) {
            const modal = document.getElementById('history-modal');
            const title = document.getElementById('modal-student-title');
            
            // í˜„ì¬ ë³´ê³  ìˆëŠ” í•™ìƒ ì •ë³´ ì €ì¥ (ì •ë ¬ ì‹œ ì¬ì‚¬ìš©)
            modal.dataset.currentStudent = JSON.stringify({ name, grade, class: studentClass, number });
            
            title.textContent = `${grade}í•™ë…„ ${studentClass}ë°˜ ${number}ë²ˆ ${name} í•™ìƒì˜ ì „ì²´ ê¸°ë¡`;
            
            renderHistoryTable();
            modal.style.display = 'block';
        }

        // ì´ë ¥ í…Œì´ë¸” ë Œë”ë§ (ì •ë ¬ ê¸°ëŠ¥ ì¶”ê°€)
        function renderHistoryTable() {
            const modal = document.getElementById('history-modal');
            const container = document.getElementById('history-table-container');
            
            if (!modal.dataset.currentStudent) return;
            
            const studentInfo = JSON.parse(modal.dataset.currentStudent);
            
            // í•´ë‹¹ í•™ìƒì˜ ëª¨ë“  ê¸°ë¡ ì°¾ê¸°
            let studentHistory = results.filter(r => 
                r.name === studentInfo.name && 
                r.grade == studentInfo.grade && 
                r.class == studentInfo.class && 
                r.number == studentInfo.number
            );

            // ì •ë ¬
            studentHistory.sort((a, b) => {
                let valA = a[modalSort.field];
                let valB = b[modalSort.field];

                if (modalSort.field === 'date') {
                    valA = new Date(valA);
                    valB = new Date(valB);
                }

                if (valA < valB) return modalSort.direction === 'asc' ? -1 : 1;
                if (valA > valB) return modalSort.direction === 'asc' ? 1 : -1;
                return 0;
            });

            // í—¤ë” ìƒì„± í•¨ìˆ˜
            const createModalHeader = (field, text) => {
                let className = 'sortable-header';
                if (modalSort.field === field) {
                    className += ` ${modalSort.direction}`;
                }
                // onclick ì´ë²¤íŠ¸ì—ì„œ ì „ì—­ í•¨ìˆ˜ í˜¸ì¶œ
                return `<th class="${className}" onclick="handleModalSort('${field}')">${text} <span class="sort-icon"></span></th>`;
            };

            const historyHtml = `
                <table>
                    <thead>
                        <tr>
                            ${createModalHeader('date', 'í…ŒìŠ¤íŠ¸ ë‚ ì§œ')}
                            <th>ìœ í˜•</th>
                            <th>ìƒìœ„ í•™ìŠµììƒ</th>
                            <th>ì‘ì—…</th>
                        </tr>
                    </thead>
                    <tbody>
                        ${studentHistory.map(result => {
                            const originalIndex = results.indexOf(result);
                            return `
                            <tr>
                                <td>${new Date(result.date).toLocaleString('ko-KR')}</td>
                                <td><span class="tag" style="background: #f3f4f6; color: #4b5563;">${result.testType || 100}ë¬¸í•­</span></td>
                                <td>
                                    ${(result.topProfiles || []).slice(0, 4).map(([profile, score]) => {
                                        const profileData = learnerProfiles[profile];
                                        return `<span class="tag" style="background-color: ${profileData.color}20; color: ${profileData.color};">
                                            ${profileData.emoji} ${profileData.name} (${score}%)
                                        </span>`;
                                    }).join('')}
                                </td>
                                <td>
                                    <button class="btn btn-danger" style="padding: 5px 10px; font-size: 0.9em;" onclick="deleteResult(${originalIndex}, true)">ì‚­ì œ</button>
                                </td>
                            </tr>
                        `}).join('')}
                    </tbody>
                </table>
            `;

            container.innerHTML = historyHtml;
        }

        // ëª¨ë‹¬ ì •ë ¬ í•¸ë“¤ëŸ¬
        function handleModalSort(field) {
            if (modalSort.field === field) {
                modalSort.direction = modalSort.direction === 'asc' ? 'desc' : 'asc';
            } else {
                modalSort.field = field;
                modalSort.direction = 'asc';
            }
            renderHistoryTable();
        }

        // ëª¨ë‹¬ ë‹«ê¸°
        document.querySelector('.close-modal').addEventListener('click', () => {
            document.getElementById('history-modal').style.display = 'none';
        });

        // ëª¨ë‹¬ ì™¸ë¶€ í´ë¦­ ì‹œ ë‹«ê¸°
        window.addEventListener('click', (event) => {
            const modal = document.getElementById('history-modal');
            if (event.target == modal) {
                modal.style.display = 'none';
            }
        });

        // ê²°ê³¼ ì‚­ì œ (ìˆ˜ì •ë¨)
        function deleteResult(index, isFromModal = false) {
            if (confirm('ì •ë§ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?')) {
                // ì‚­ì œ ì „ ì •ë³´ ì €ì¥ (ëª¨ë‹¬ ê°±ì‹ ìš©)
                const deletedItem = results[index];
                
                results.splice(index, 1);
                localStorage.setItem('ibTestResults', JSON.stringify(results));
                
                // í™”ë©´ ê°±ì‹ 
                initFilters(); // í•„í„° ëª©ë¡ ê°±ì‹ 
                renderStudentList();
                renderOverview();
                
                // ëª¨ë‹¬ì—ì„œ ì‚­ì œí–ˆë‹¤ë©´ ëª¨ë‹¬ ë‚´ìš©ë„ ê°±ì‹ 
                if (isFromModal) {
                    // ì•„ì§ í•´ë‹¹ í•™ìƒì˜ ë°ì´í„°ê°€ ë‚¨ì•„ìˆëŠ”ì§€ í™•ì¸
                    const remaining = results.filter(r => 
                        r.name === deletedItem.name && 
                        r.grade === deletedItem.grade && 
                        r.class === deletedItem.class && 
                        r.number === deletedItem.number
                    );
                    
                    if (remaining.length > 0) {
                        renderHistoryTable(); // ëª¨ë‹¬ í…Œì´ë¸”ë§Œ ë‹¤ì‹œ ë Œë”ë§
                    } else {
                        document.getElementById('history-modal').style.display = 'none';
                    }
                }
            }
        }

        // í†µê³„ ë Œë”ë§
        function renderStatistics() {
            const filteredData = getFilteredResults();

            if (filteredData.length === 0) {
                document.getElementById('detailed-stats').innerHTML = `
                    <div class="empty-state">
                        <div class="empty-state-icon">ğŸ“Š</div>
                        <p>í†µê³„ë¥¼ í‘œì‹œí•  ë°ì´í„°ê°€ ì—†ìŠµë‹ˆë‹¤.</p>
                    </div>
                `;
                // ì°¨íŠ¸ ì´ˆê¸°í™”
                if (radarChartInstance) {
                    radarChartInstance.destroy();
                    radarChartInstance = null;
                }
                return;
            }

            // í‰ê·  ì ìˆ˜ ê³„ì‚°
            const profileAverages = {};
            Object.keys(learnerProfiles).forEach(profile => {
                const total = filteredData.reduce((sum, r) => sum + (r.scores[profile] || 0), 0);
                profileAverages[profile] = Math.round(total / filteredData.length);
            });

            // ë ˆì´ë” ì°¨íŠ¸
            if (radarChartInstance) {
                radarChartInstance.destroy();
            }

            const ctx = document.getElementById('radarChart').getContext('2d');
            radarChartInstance = new Chart(ctx, {
                type: 'radar',
                data: {
                    labels: Object.values(learnerProfiles).map(p => p.name),
                    datasets: [{
                        label: 'í‰ê·  ì ìˆ˜',
                        data: Object.keys(learnerProfiles).map(key => profileAverages[key]),
                        backgroundColor: 'rgba(102, 126, 234, 0.2)',
                        borderColor: 'rgba(102, 126, 234, 1)',
                        borderWidth: 2,
                        pointBackgroundColor: 'rgba(102, 126, 234, 1)',
                        pointBorderColor: '#fff',
                        pointHoverBackgroundColor: '#fff',
                        pointHoverBorderColor: 'rgba(102, 126, 234, 1)'
                    }]
                },
                options: {
                    scales: {
                        r: {
                            beginAtZero: true,
                            max: 100,
                            ticks: {
                                stepSize: 20
                            }
                        }
                    },
                    plugins: {
                        legend: {
                            display: false
                        }
                    }
                }
            });

            // ìƒì„¸ í†µê³„
            const detailedStatsHtml = Object.entries(profileAverages)
                .sort((a, b) => b[1] - a[1])
                .map(([profile, avg]) => {
                    const profileData = learnerProfiles[profile];
                    return `
                        <div class="profile-item" style="margin-bottom: 20px;">
                            <span class="profile-name">${profileData.emoji} ${profileData.name}</span>
                            <div class="profile-bar-container">
                                <div class="profile-bar">
                                    <div class="profile-bar-fill" style="width: ${avg}%; background-color: ${profileData.color};"></div>
                                </div>
                            </div>
                            <span class="profile-score" style="color: ${profileData.color};">${avg}%</span>
                        </div>
                    `;
                }).join('');
            
            document.getElementById('detailed-stats').innerHTML = detailedStatsHtml;
        }

        // ê²°ê³¼ ì‚­ì œ
        function deleteResult(index) {
            if (confirm('ì •ë§ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?')) {
                results.splice(index, 1);
                localStorage.setItem('ibTestResults', JSON.stringify(results));
                
                // ì‚­ì œ í›„ í•„í„° ëª©ë¡ ê°±ì‹  (í•™ë…„/ë°˜ì´ ì‚¬ë¼ì§ˆ ìˆ˜ ìˆìœ¼ë¯€ë¡œ)
                initFilters();
                
                // í˜„ì¬ íƒ­ í™”ë©´ ê°±ì‹ 
                updateDashboard();
            }
        }

        // ì „ì²´ ì‚­ì œ
        document.getElementById('clear-all').addEventListener('click', () => {
            if (confirm('í˜„ì¬ í•„í„°ë§ëœ ëª©ë¡ì„ í¬í•¨í•˜ì—¬ ëª¨ë“  ë°ì´í„°ë¥¼ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ? ì´ ì‘ì—…ì€ ë˜ëŒë¦´ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.')) {
                localStorage.removeItem('ibTestResults');
                results = [];
                initFilters();
                updateDashboard();
            }
        });

        // CSV ë‚´ë³´ë‚´ê¸°
        document.getElementById('export-csv').addEventListener('click', () => {
            if (results.length === 0) {
                alert('ë‚´ë³´ë‚¼ ë°ì´í„°ê°€ ì—†ìŠµë‹ˆë‹¤.');
                return;
            }

            const headers = ['ì´ë¦„', 'í•™ë…„', 'ë°˜', 'ë²ˆí˜¸', 'í…ŒìŠ¤íŠ¸ ë‚ ì§œ', ...Object.values(learnerProfiles).map(p => p.name)];
            const rows = results.map(r => [
                r.name,
                r.grade,
                r.class,
                r.number,
                new Date(r.date).toLocaleString('ko-KR'),
                ...Object.keys(learnerProfiles).map(key => r.scores[key])
            ]);

            let csv = headers.join(',') + '\n';
            rows.forEach(row => {
                csv += row.join(',') + '\n';
            });

            const blob = new Blob(['\uFEFF' + csv], { type: 'text/csv;charset=utf-8;' });
            const link = document.createElement('a');
            link.href = URL.createObjectURL(blob);
            link.download = `IBí•™ìŠµììƒ_ì§„ë‹¨ê²°ê³¼_${new Date().toLocaleDateString('ko-KR')}.csv`;
            link.click();
        });

        // ì´ˆê¸°í™”
        loadResults(); // ë¹„ë™ê¸° í˜¸ì¶œì´ì§€ë§Œ ì´ˆê¸°í™” íë¦„ìƒ ê·¸ëŒ€ë¡œ ë‘ 
        loadQuestions(); // ì§ˆë¬¸ ë°ì´í„° ë¡œë“œ
        initQuestionFilter(); // ì§ˆë¬¸ í•„í„° ì´ˆê¸°í™”
        // renderOverview(); // loadResults ë‚´ë¶€ë¡œ ì´ë™ë¨
        // renderStudentList(); // loadResults ë‚´ë¶€ë¡œ ì´ë™ë¨
    </script>
</body>
</html>